<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asonik Store</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React -->
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <!-- Babel to transpile JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Firebase -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js";
        import { getFirestore, collection, onSnapshot, addDoc, doc, deleteDoc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js";
        
        window.firebase = {
            initializeApp, getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut,
            getFirestore, collection, onSnapshot, addDoc, doc, deleteDoc, setDoc, serverTimestamp
        };
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        .dropdown:hover .dropdown-menu { display: block; }
    </style>
</head>
<body class="bg-gray-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;
        const { 
            initializeApp, getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut, 
            getFirestore, collection, onSnapshot, addDoc, doc, deleteDoc, setDoc, serverTimestamp 
        } = window.firebase;

        // --- App Configuration ---
        const firebaseConfig = {
            apiKey: "AIzaSyC7smDYoy-LT58xCwjJsc9uZU9CgHQv5dM",
            authDomain: "ya-buxgalter.firebaseapp.com",
            projectId: "ya-buxgalter",
            storageBucket: "ya-buxgalter.appspot.com",
            messagingSenderId: "640345805387",
            appId: "1:640345805387:web:a1adade77f809af84cb3ce",
            measurementId: "G-0TKE25JVXG"
        };
        const ADMIN_UID = 'YOUR_ADMIN_UID'; // ЗАМЕНИТЕ ЭТО НА ВАШ UID

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();

        const logoBase64 = "data:image/jpeg;base64,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AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA-";

        // --- Helper Components ---

        const Logo = () => (
            <div className="flex items-center space-x-2 cursor-pointer">
                <img 
                    src={logoBase64} 
                    alt="Asonik Store Logo" 
                    className="h-12 w-12 object-contain"
                />
                <span className="text-2xl md:text-3xl font-bold text-white tracking-wider">
                    Asonik <span className="text-purple-300">Store</span>
                </span>
            </div>
        );

        const LoadingSpinner = () => (
            <div className="flex justify-center items-center h-full">
                <div className="animate-spin rounded-full h-32 w-32 border-t-4 border-b-4 border-purple-400"></div>
            </div>
        );

        const Modal = ({ children, onClose }) => (
            <div className="fixed inset-0 bg-black bg-opacity-75 z-50 flex justify-center items-center p-4 transition-opacity duration-300">
                <div className="bg-gray-800 rounded-2xl shadow-2xl p-6 md:p-8 w-full max-w-md relative border border-purple-700 transform transition-transform duration-300 scale-95 animate-scale-in">
                    <button onClick={onClose} className="absolute top-4 right-4 text-gray-400 hover:text-white transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" className="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                    {children}
                </div>
                <style>{`
                    @keyframes scale-in { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
                    .animate-scale-in { animation: scale-in 0.3s ease-out forwards; }
                `}</style>
            </div>
        );

        const AlertModal = ({ message, onConfirm, onCancel, t }) => (
            <Modal onClose={onCancel}>
                <div className="text-center">
                    <h2 className="text-2xl font-bold text-white mb-4">{t.confirmation}</h2>
                    <p className="text-gray-300 mb-6">{message}</p>
                    <div className={`flex ${onConfirm ? 'justify-between' : 'justify-center'} space-x-4`}>
                        <button onClick={onCancel} className="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-6 rounded-lg transition-colors">
                            {onConfirm ? t.cancel : t.ok}
                        </button>
                        {onConfirm && (
                            <button onClick={onConfirm} className="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-6 rounded-lg transition-colors">
                                {t.confirm}
                            </button>
                        )}
                    </div>
                </div>
            </Modal>
        );
        
        const ProfileModal = ({ user, onClose, t }) => (
            <Modal onClose={onClose}>
                <div className="text-center text-white">
                    <h2 className="text-3xl font-bold mb-4">{t.profile}</h2>
                    <img src={user.photoURL} alt={user.displayName} className="w-24 h-24 rounded-full mx-auto mb-4 border-4 border-purple-500"/>
                    <p className="text-xl mb-2">{user.displayName}</p>
                    <p className="text-gray-400">{user.email}</p>
                </div>
            </Modal>
        );

        // --- Main Components ---

        function Header({ user, onLogin, onLogout, setPage, isAdmin, t, currency, setCurrency, language, setLanguage, setProfileVisible }) {
            const [dropdownOpen, setDropdownOpen] = useState(false);

            return (
                <header className="bg-gray-900 bg-opacity-80 backdrop-blur-md p-4 shadow-lg sticky top-0 z-40 border-b border-purple-800">
                    <div className="container mx-auto flex justify-between items-center">
                        <div onClick={() => setPage('home')}><Logo /></div>
                        <nav className="hidden md:flex items-center space-x-6">
                            <button onClick={() => setPage('home')} className="text-gray-300 hover:text-white font-medium transition-colors">{t.home}</button>
                            <button onClick={() => setPage('support')} className="text-gray-300 hover:text-white font-medium transition-colors">{t.support}</button>
                            {isAdmin && <button onClick={() => setPage('admin')} className="text-purple-400 hover:text-purple-300 font-bold transition-colors">{t.admin}</button>}
                        </nav>
                        <div className="flex items-center space-x-4">
                             {/* Language & Currency Switchers */}
                            <select value={language} onChange={e => setLanguage(e.target.value)} className="bg-gray-700 text-white border-none rounded-md p-2 cursor-pointer">
                                <option value="ru">RU</option><option value="en">EN</option><option value="uz">UZ</option>
                            </select>
                            <select value={currency} onChange={e => setCurrency(e.target.value)} className="bg-gray-700 text-white border-none rounded-md p-2 cursor-pointer">
                                <option value="RUB">₽ RUB</option><option value="USD">$ USD</option><option value="UZS">S'om UZS</option>
                            </select>
                            {user ? (
                                <div className="relative dropdown">
                                    <button onClick={() => setDropdownOpen(!dropdownOpen)} className="flex items-center space-x-2">
                                        <img src={user.photoURL} alt={user.displayName} className="h-10 w-10 rounded-full border-2 border-purple-500" />
                                        <svg className={`w-4 h-4 text-white transition-transform ${dropdownOpen ? 'transform rotate-180' : ''}`} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 9l-7 7-7-7"></path></svg>
                                    </button>
                                    {dropdownOpen && (
                                        <div className="absolute right-0 mt-2 w-48 bg-gray-800 rounded-md shadow-lg py-1 z-50 border border-purple-700 dropdown-menu">
                                            <a href="#" onClick={(e) => { e.preventDefault(); setProfileVisible(true); setDropdownOpen(false); }} className="block px-4 py-2 text-sm text-gray-300 hover:bg-purple-600">{t.profile}</a>
                                            <a href="#" onClick={(e) => { e.preventDefault(); onLogout(); setDropdownOpen(false); }} className="block px-4 py-2 text-sm text-gray-300 hover:bg-purple-600">{t.logout}</a>
                                        </div>
                                    )}
                                </div>
                            ) : (
                                <button onClick={onLogin} className="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-lg transition-transform transform hover:scale-105 flex items-center space-x-2">
                                    <span>{t.login}</span>
                                </button>
                            )}
                        </div>
                    </div>
                </header>
            );
        }

        function ProductCard({ product, onBuy, user, setAlertInfo, t, currency, convertPrice }) {
            const handleBuyClick = () => {
                if (user) onBuy(product);
                else setAlertInfo({ message: t.loginToBuy });
            };
            return (
                <div className="bg-gray-800 rounded-2xl overflow-hidden shadow-lg border border-gray-700 transform hover:-translate-y-2 transition-transform duration-300 flex flex-col">
                    <img className="w-full h-56 object-cover" src={product.imageUrl} alt={product.name} onError={(e) => { e.target.onerror = null; e.target.src='https://placehold.co/600x400/1f2937/374151?text=Image+Not+Found'; }}/>
                    <div className="p-6 flex flex-col flex-grow">
                        <h3 className="text-2xl font-bold text-white mb-1">{product.name}</h3>
                        {product.nominal && <p className="text-purple-300 font-semibold mb-2">{product.nominal}</p>}
                        <p className="text-gray-400 text-base mb-4 flex-grow">{product.description}</p>
                        <div className="flex justify-between items-center">
                            <span className="text-3xl font-bold text-purple-400">{convertPrice(product.price, currency)}</span>
                            <button onClick={handleBuyClick} className={`font-bold py-2 px-6 rounded-lg transition-all duration-300 ${user ? 'bg-purple-600 hover:bg-purple-700 text-white shadow-md hover:shadow-lg' : 'bg-gray-600 text-gray-400 cursor-not-allowed'}`}>
                                {t.buy}
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        function PurchaseModal({ product, onClose, onConfirm, t, currency, convertPrice }) {
            const handleContactSeller = async () => {
                await onConfirm(product);
                window.open('https://t.me/asonikofficial', '_blank');
                onClose();
            };

            return (
                <Modal onClose={onClose}>
                    <div className="text-center">
                        <h2 className="text-3xl font-bold text-white mb-2">{t.checkout}</h2>
                        <p className="text-gray-400 mb-6">{t.youAreBuying}: <span className="font-bold text-purple-300">{product.name}</span></p>
                        <div className="space-y-4">
                            <h3 className="text-xl text-white">{t.choosePayment}</h3>
                            <button onClick={handleContactSeller} className="w-full bg-teal-500 hover:bg-teal-600 text-white font-bold py-3 px-4 rounded-lg transition-transform transform hover:scale-105">
                                {t.contactSeller}
                            </button>
                            <button disabled className="w-full bg-gray-600 text-gray-400 font-bold py-3 px-4 rounded-lg cursor-not-allowed">YooMoney ({t.unavailable})</button>
                            <button disabled className="w-full bg-gray-600 text-gray-400 font-bold py-3 px-4 rounded-lg cursor-not-allowed">{t.cardPayment} ({t.unavailable})</button>
                            <button disabled className="w-full bg-gray-600 text-gray-400 font-bold py-3 px-4 rounded-lg cursor-not-allowed">{t.bankTransfer} ({t.unavailable})</button>
                        </div>
                    </div>
                </Modal>
            );
        }

        function HomePage({ products, onBuy, user, setAlertInfo, t, currency, convertPrice }) {
            return (
                <main className="container mx-auto p-4 md:p-8">
                    <h1 className="text-4xl md:text-5xl font-black text-white text-center mb-4 tracking-wide">{t.catalogTitle}</h1>
                    <p className="text-purple-300 text-center mb-12 text-lg">{t.catalogSubtitle}</p>
                    {products.length === 0 ? (
                         <p className="text-center text-gray-400 text-xl">{t.productsComingSoon}</p>
                    ) : (
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                            {products.map(product => (
                                <ProductCard key={product.id} product={product} onBuy={onBuy} user={user} setAlertInfo={setAlertInfo} t={t} currency={currency} convertPrice={convertPrice} />
                            ))}
                        </div>
                    )}
                </main>
            );
        }

        function AdminPage({ products, orders, tickets, setAlertInfo, t }) {
            const [name, setName] = useState('');
            const [description, setDescription] = useState('');
            const [price, setPrice] = useState('');
            const [imageUrl, setImageUrl] = useState('');
            const [nominal, setNominal] = useState('');
            const [editingProduct, setEditingProduct] = useState(null);

            const resetForm = () => {
                setName(''); setDescription(''); setPrice(''); setImageUrl(''); setNominal(''); setEditingProduct(null);
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                if (!name || !description || !price || !imageUrl) {
                    setAlertInfo({ message: t.fillAllFields }); return;
                }
                const productData = { name, description, price: Number(price), imageUrl, nominal };
                try {
                    if (editingProduct) {
                        await setDoc(doc(db, 'products', editingProduct.id), productData);
                        setAlertInfo({ message: t.productUpdated });
                    } else {
                        await addDoc(collection(db, 'products'), productData);
                        setAlertInfo({ message: t.productAdded });
                    }
                    resetForm();
                } catch (error) {
                    console.error("Error adding/updating product: ", error);
                    setAlertInfo({ message: t.errorOccurred });
                }
            };

            const handleDelete = (productId) => {
                setAlertInfo({
                    message: t.confirmDelete,
                    onConfirm: async () => {
                        try {
                            await deleteDoc(doc(db, 'products', productId));
                            setAlertInfo({ message: t.productDeleted });
                        } catch (error) {
                            setAlertInfo({ message: t.errorOccurred });
                        }
                    }
                });
            };
            
            const handleEdit = (product) => {
                setEditingProduct(product);
                setName(product.name); setDescription(product.description); setPrice(product.price);
                setImageUrl(product.imageUrl); setNominal(product.nominal || '');
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };

            return (
                <div className="container mx-auto p-4 md:p-8 text-white">
                    <h1 className="text-4xl font-bold mb-8 text-center">{t.adminPanel}</h1>
                    <div className="bg-gray-800 p-8 rounded-2xl mb-12 border border-purple-700">
                        <h2 className="text-2xl font-bold mb-6">{editingProduct ? t.editProduct : t.addProduct}</h2>
                        <form onSubmit={handleSubmit} className="space-y-4">
                            <input type="text" placeholder={t.productName} value={name} onChange={e => setName(e.target.value)} className="w-full p-3 bg-gray-700 rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-purple-500" />
                            <input type="text" placeholder={t.productNominal} value={nominal} onChange={e => setNominal(e.target.value)} className="w-full p-3 bg-gray-700 rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-purple-500" />
                            <textarea placeholder={t.description} value={description} onChange={e => setDescription(e.target.value)} className="w-full p-3 bg-gray-700 rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-purple-500 h-32"></textarea>
                            <input type="number" placeholder={t.priceInRub} value={price} onChange={e => setPrice(e.target.value)} className="w-full p-3 bg-gray-700 rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-purple-500" />
                            <input type="text" placeholder={t.imageUrl} value={imageUrl} onChange={e => setImageUrl(e.target.value)} className="w-full p-3 bg-gray-700 rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-purple-500" />
                            <div className="flex space-x-4">
                                <button type="submit" className="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-4 rounded-lg transition-colors">{editingProduct ? t.updateProduct : t.addProductBtn}</button>
                                {editingProduct && <button type="button" onClick={resetForm} className="w-full bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-lg transition-colors">{t.cancel}</button>}
                            </div>
                        </form>
                    </div>
                    {/* Lists of products, orders, tickets */}
                </div>
            );
        }

        function SupportPage({ user, setAlertInfo, t }) {
            const [message, setMessage] = useState('');
            const [isSent, setIsSent] = useState(false);

            const handleSubmit = async (e) => {
                e.preventDefault();
                if (!message.trim()) {
                    setAlertInfo({ message: t.enterMessage }); return;
                }
                try {
                    await addDoc(collection(db, 'supportTickets'), {
                        message: message, userId: user ? user.uid : 'anonymous',
                        userEmail: user ? user.email : 'anonymous', timestamp: serverTimestamp()
                    });
                    setMessage(''); setIsSent(true);
                    setTimeout(() => setIsSent(false), 5000);
                } catch (error) {
                    setAlertInfo({ message: t.errorOccurred });
                }
            };

            return (
                <div className="container mx-auto p-4 md:p-8 text-white flex-grow flex flex-col items-center justify-center">
                    <div className="w-full max-w-2xl bg-gray-800 p-8 rounded-2xl border border-purple-700">
                        <h1 className="text-4xl font-bold mb-6 text-center">{t.support}</h1>
                        <p className="text-center text-gray-400 mb-8">{t.supportSubtitle}</p>
                        {isSent ? (
                            <div className="bg-green-500 text-white text-center p-4 rounded-lg">{t.messageSent}</div>
                        ) : (
                            <form onSubmit={handleSubmit} className="space-y-6">
                                <textarea value={message} onChange={(e) => setMessage(e.target.value)} placeholder={t.enterMessagePlaceholder} className="w-full p-4 bg-gray-700 rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-purple-500 h-48 resize-none"></textarea>
                                <button type="submit" className="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-4 rounded-lg transition-transform transform hover:scale-105">{t.send}</button>
                            </form>
                        )}
                    </div>
                </div>
            );
        }

        function Footer({t}) {
            return (
                <footer className="bg-gray-900 text-gray-400 p-6 mt-12 border-t border-purple-800">
                    <div className="container mx-auto text-center">
                        <p>&copy; {new Date().getFullYear()} Asonik Store. {t.rightsReserved}</p>
                        <p className="text-sm mt-2">{t.developedWithLove}</p>
                    </div>
                </footer>
            );
        }

        function App() {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);
            const [products, setProducts] = useState([]);
            const [orders, setOrders] = useState([]);
            const [tickets, setTickets] = useState([]);
            const [selectedProduct, setSelectedProduct] = useState(null);
            const [page, setPage] = useState('home');
            const [alertInfo, setAlertInfo] = useState(null);
            const [language, setLanguage] = useState('ru');
            const [currency, setCurrency] = useState('RUB');
            const [profileVisible, setProfileVisible] = useState(false);
            
            const isAdmin = user && user.uid === ADMIN_UID;
            const t = translations[language];
            
            // --- Effects for auth and data fetching ---
            useEffect(() => {
                const unsubscribe = onAuthStateChanged(auth, (currentUser) => {
                    setUser(currentUser);
                    if (currentUser) console.log("Your Admin UID:", currentUser.uid);
                    setLoading(false);
                });
                return () => unsubscribe();
            }, []);

            useEffect(() => {
                const unsubProducts = onSnapshot(collection(db, "products"), (snapshot) => {
                    setProducts(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                });
                let unsubOrders = () => {}, unsubTickets = () => {};
                if (isAdmin) {
                    unsubOrders = onSnapshot(collection(db, "orders"), (snapshot) => setOrders(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }))));
                    unsubTickets = onSnapshot(collection(db, "supportTickets"), (snapshot) => setTickets(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }))));
                }
                return () => { unsubProducts(); unsubOrders(); unsubTickets(); };
            }, [isAdmin]);

            const handleLogin = async () => { try { await signInWithPopup(auth, provider); } catch (error) { console.error("Login Error:", error); } };
            const handleLogout = async () => { try { await signOut(auth); setPage('home'); } catch (error) { console.error("Logout Error:", error); } };
            const handleBuy = (product) => setSelectedProduct(product);

            const handleConfirmPurchase = async (product) => {
                if (!user) return;
                try {
                    await addDoc(collection(db, 'orders'), {
                        userId: user.uid, userEmail: user.email, productId: product.id,
                        productName: product.name, timestamp: serverTimestamp()
                    });
                } catch (error) { console.error("Order creation error: ", error); }
            };
            
            const handleAlertConfirm = () => {
                if (alertInfo && alertInfo.onConfirm) alertInfo.onConfirm();
                setAlertInfo(null);
            };

            const renderPage = () => {
                switch (page) {
                    case 'admin': return isAdmin ? <AdminPage {...{products, orders, tickets, setAlertInfo, t}} /> : <HomePage {...{products, onBuy: handleBuy, user, setAlertInfo, t, currency, convertPrice}} />;
                    case 'support': return <SupportPage {...{user, setAlertInfo, t}}/>;
                    default: return <HomePage {...{products, onBuy: handleBuy, user, setAlertInfo, t, currency, convertPrice}} />;
                }
            };

            if (loading) return <div className="bg-gray-900 min-h-screen flex items-center justify-center"><LoadingSpinner /></div>;

            return (
                <div className="bg-gray-900 min-h-screen font-sans bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900 flex flex-col">
                    <Header {...{user, onLogin: handleLogin, onLogout: handleLogout, setPage, isAdmin, t, currency, setCurrency, language, setLanguage, setProfileVisible}} />
                    <div className="flex-grow">{renderPage()}</div>
                    {selectedProduct && <PurchaseModal {...{product: selectedProduct, onClose: () => setSelectedProduct(null), onConfirm: handleConfirmPurchase, t, currency, convertPrice}} />}
                    {alertInfo && <AlertModal message={alertInfo.message} onConfirm={alertInfo.onConfirm ? handleAlertConfirm : null} onCancel={() => setAlertInfo(null)} t={t} />}
                    {profileVisible && user && <ProfileModal user={user} onClose={() => setProfileVisible(false)} t={t} />}
                    <Footer t={t}/>
                </div>
            );
        }
        
        // --- Localization & Currency ---
        const translations = {
            ru: {
                home: 'Главная', support: 'Поддержка', admin: 'Админ', profile: 'Профиль', logout: 'Выйти', login: 'Войти с Google',
                buy: 'Купить', confirmation: 'Подтверждение', cancel: 'Отмена', ok: 'OK', confirm: 'Подтвердить',
                loginToBuy: 'Пожалуйста, войдите в аккаунт, чтобы совершить покупку.',
                checkout: 'Оформление заказа', youAreBuying: 'Вы покупаете', choosePayment: 'Выберите способ оплаты',
                contactSeller: 'Связаться с продавцом (Telegram)', unavailable: 'Недоступно', cardPayment: 'Оплата картой', bankTransfer: 'Безналичный расчет',
                catalogTitle: 'КАТАЛОГ ТОВАРОВ', catalogSubtitle: 'Лучшие предложения только для вас', productsComingSoon: 'Товары скоро появятся...',
                adminPanel: 'Панель администратора', addProduct: 'Добавить новый товар', editProduct: 'Редактировать товар',
                productName: 'Название товара', productNominal: 'Номинал (н-р: 100 гемов)', description: 'Описание', priceInRub: 'Цена (в RUB)', imageUrl: 'URL изображения',
                addProductBtn: 'Добавить товар', updateProduct: 'Обновить товар', fillAllFields: 'Пожалуйста, заполните все поля.',
                productAdded: 'Товар успешно добавлен!', productUpdated: 'Товар успешно обновлен!', errorOccurred: 'Произошла ошибка.',
                confirmDelete: 'Вы уверены, что хотите удалить этот товар?', productDeleted: 'Товар удален.',
                supportSubtitle: 'Есть вопросы или предложения? Напишите нам!', messageSent: 'Ваше сообщение успешно отправлено!',
                enterMessage: 'Пожалуйста, введите ваше сообщение.', enterMessagePlaceholder: 'Введите ваше сообщение здесь...', send: 'Отправить',
                rightsReserved: 'Все права защищены.', developedWithLove: 'Дизайн и разработка с ❤️'
            },
            en: {
                home: 'Home', support: 'Support', admin: 'Admin', profile: 'Profile', logout: 'Logout', login: 'Login with Google',
                buy: 'Buy', confirmation: 'Confirmation', cancel: 'Cancel', ok: 'OK', confirm: 'Confirm',
                loginToBuy: 'Please log in to make a purchase.',
                checkout: 'Checkout', youAreBuying: 'You are buying', choosePayment: 'Choose payment method',
                contactSeller: 'Contact seller (Telegram)', unavailable: 'Unavailable', cardPayment: 'Card Payment', bankTransfer: 'Bank Transfer',
                catalogTitle: 'PRODUCT CATALOG', catalogSubtitle: 'The best offers just for you', productsComingSoon: 'Products are coming soon...',
                adminPanel: 'Admin Panel', addProduct: 'Add New Product', editProduct: 'Edit Product',
                productName: 'Product Name', productNominal: 'Denomination (e.g., 100 gems)', description: 'Description', priceInRub: 'Price (in RUB)', imageUrl: 'Image URL',
                addProductBtn: 'Add Product', updateProduct: 'Update Product', fillAllFields: 'Please fill in all fields.',
                productAdded: 'Product added successfully!', productUpdated: 'Product updated successfully!', errorOccurred: 'An error occurred.',
                confirmDelete: 'Are you sure you want to delete this product?', productDeleted: 'Product deleted.',
                supportSubtitle: 'Have questions or suggestions? Write to us!', messageSent: 'Your message has been sent successfully!',
                enterMessage: 'Please enter your message.', enterMessagePlaceholder: 'Enter your message here...', send: 'Send',
                rightsReserved: 'All rights reserved.', developedWithLove: 'Designed and developed with ❤️'
            },
            uz: {
                home: 'Bosh sahifa', support: 'Qo\'llab-quvvatlash', admin: 'Admin', profile: 'Profil', logout: 'Chiqish', login: 'Google bilan kirish',
                buy: 'Sotib olish', confirmation: 'Tasdiqlash', cancel: 'Bekor qilish', ok: 'OK', confirm: 'Tasdiqlash',
                loginToBuy: 'Xarid qilish uchun tizimga kiring.',
                checkout: 'Buyurtmani rasmiylashtirish', youAreBuying: 'Siz xarid qilyapsiz', choosePayment: 'To\'lov usulini tanlang',
                contactSeller: 'Sotuvchi bilan bog\'lanish (Telegram)', unavailable: 'Mavjud emas', cardPayment: 'Karta orqali to\'lov', bankTransfer: 'Pulsiz hisob-kitob',
                catalogTitle: 'MAHSULOTLAR KATALOGI', catalogSubtitle: 'Eng yaxshi takliflar faqat siz uchun', productsComingSoon: 'Mahsulotlar tez kunda...',
                adminPanel: 'Administrator paneli', addProduct: 'Yangi mahsulot qo\'shish', editProduct: 'Mahsulotni tahrirlash',
                productName: 'Mahsulot nomi', productNominal: 'Nominal (masalan: 100 gem)', description: 'Tavsif', priceInRub: 'Narx (RUBda)', imageUrl: 'Rasm URL manzili',
                addProductBtn: 'Mahsulot qo\'shish', updateProduct: 'Mahsulotni yangilash', fillAllFields: 'Iltimos, barcha maydonlarni to\'ldiring.',
                productAdded: 'Mahsulot muvaffaqiyatli qo\'shildi!', productUpdated: 'Mahsulot muvaffaqiyatli yangilandi!', errorOccurred: 'Xatolik yuz berdi.',
                confirmDelete: 'Haqiqatan ham ushbu mahsulotni o\'chirib tashlamoqchimisiz?', productDeleted: 'Mahsulot o\'chirildi.',
                supportSubtitle: 'Savollaringiz yoki takliflaringiz bormi? Bizga yozing!', messageSent: 'Sizning xabaringiz muvaffaqiyatli yuborildi!',
                enterMessage: 'Iltimos, xabaringizni kiriting.', enterMessagePlaceholder: 'Xabaringizni shu yerga kiriting...', send: 'Yuborish',
                rightsReserved: 'Barcha huquqlar himoyalangan.', developedWithLove: '❤️ bilan ishlab chiqilgan'
            }
        };

        const currencyRates = { RUB: 1, USD: 0.011, UZS: 140 };
        const currencySymbols = { RUB: '₽', USD: '$', UZS: 'S\'om' };

        const convertPrice = (priceInRub, targetCurrency) => {
            const rate = currencyRates[targetCurrency];
            const symbol = currencySymbols[targetCurrency];
            if (!rate || !priceInRub) return `0 ${symbol}`;
            const convertedPrice = priceInRub * rate;
            return `${convertedPrice.toLocaleString('en-US', { maximumFractionDigits: 2 })} ${symbol}`;
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
