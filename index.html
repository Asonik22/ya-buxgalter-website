<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asonik Store</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React -->
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <!-- Babel to transpile JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Firebase -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut, updateProfile } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js";
        import { getFirestore, collection, onSnapshot, addDoc, doc, deleteDoc, setDoc, serverTimestamp, query, where, orderBy, updateDoc, getDocs, increment, getDoc } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js";
        
        window.firebase = {
            initializeApp, getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut, updateProfile,
            getFirestore, collection, onSnapshot, addDoc, doc, deleteDoc, setDoc, serverTimestamp, query, where, orderBy, updateDoc, getDocs, increment, getDoc
        };
    </script>
    <style>
        body { font-family: 'Inter', sans-serif; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; transition: background-color 0.3s, color 0.3s; }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        
        :root {
            --bg-primary: #111827;
            --bg-secondary: #1f2937;
            --bg-tertiary: #374151;
            --text-primary: #f9fafb;
            --text-secondary: #d1d5db;
            --accent-primary: #8b5cf6;
            --accent-secondary: #a78bfa;
            --border-color: #374151;
        }
        body.light {
            --bg-primary: #f9fafb;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f3f4f6;
            --text-primary: #111827;
            --text-secondary: #4b5563;
            --border-color: #e5e7eb;
        }
        body.asonik {
            --bg-primary: linear-gradient(135deg, #6d28d9, #4c1d95);
            --bg-secondary: rgba(255, 255, 255, 0.1); /* Glassmorphism effect */
            --bg-tertiary: rgba(255, 255, 255, 0.2);
            --text-primary: #f5d0fe;
            --text-secondary: #e9d5ff;
            --accent-primary: #f5d0fe;
            --accent-secondary: #ffffff;
            --border-color: rgba(255, 255, 255, 0.2);
        }
        .asonik .accent-text { color: var(--accent-primary); }
        .asonik .text-primary { color: #ffffff; }
        .asonik .text-secondary { color: #e9d5ff; }
        .asonik .bg-secondary { backdrop-filter: blur(10px); }
        .asonik .border-color { border-color: var(--border-color); }


        .bg-primary { background: var(--bg-primary); }
        .bg-secondary { background-color: var(--bg-secondary); }
        .bg-tertiary { background-color: var(--bg-tertiary); }
        .text-primary { color: var(--text-primary); }
        .text-secondary { color: var(--text-secondary); }
        .border-color { border-color: var(--border-color); }
        .accent-text { color: var(--accent-primary); }
        .accent-bg { background-color: var(--accent-primary); }
        .accent-border { border-color: var(--accent-primary); }
        .hover\:accent-bg:hover { background-color: var(--accent-primary); }
        .hover\:accent-bg-secondary:hover { background-color: var(--accent-secondary); }
        
        .chat-bubble { max-width: 75%; word-wrap: break-word; }
        .chat-bubble-user { background-color: #4f46e5; }
        .chat-bubble-admin { background-color: #374151; }
    </style>
</head>
<body class="bg-primary text-primary">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef, useMemo } = React;
        const { 
            initializeApp, getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut, updateProfile,
            getFirestore, collection, onSnapshot, addDoc, doc, deleteDoc, setDoc, serverTimestamp, query, where, orderBy, updateDoc, getDocs, increment, getDoc
        } = window.firebase;

        // --- App Configuration ---
        const firebaseConfig = {
            apiKey: "AIzaSyC7smDYoy-LT58xCwjJsc9uZU9CgHQv5dM",
            authDomain: "ya-buxgalter.firebaseapp.com",
            projectId: "ya-buxgalter",
            storageBucket: "ya-buxgalter.appspot.com",
            messagingSenderId: "640345805387",
            appId: "1:640345805387:web:a1adade77f809af84cb3ce",
            measurementId: "G-0TKE25JVXG"
        };
        
        const ADMIN_UID = 'vhmtXZxkZnOWviNQ39R1W3GE8mw2';
        const IMGBB_API_KEY = '96bf3f29606f1989bb5a450ad3770cce';

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();

        const logoBase64 = "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAAgACADASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAYDBAUH/8QAIxAAAQQCAgICAwAAAAAAAAAAAQIDBAUGEQASITFBURMUYf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwD2ERkACK5uX1WzYtprKqKxckO2E5sNqS0lxLbqFpWlQBSoAgjYI9j39cZkABEV7OpaO6xYlXl0V6bYSHENNR2klS1qUoJSkAekkkgD+8YkABGczL6bT1kuyupLMNhhJWtbywkgD6Gz1J+g98ZkAB//2Q==";
        const qrCodeBase64 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPoAAAD6CAYAAACI7/P6AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAIeElEQVR42u3dQY4jNxJA0ff8/5+zJ8gYIMuN2Uk2ZzQBse2S1sTExP//AwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA-";

        // --- Helper Components ---
        const Logo = ()-&gt; ( &lt;div className="flex items-center space-x-2 cursor-pointer"&gt; &lt;img src={logoBase64} alt="Asonik Store Logo" className="h-12 w-12 object-contain"/&gt; &lt;span className="text-2xl md:text-3xl font-bold text-primary tracking-wider"&gt; Asonik &lt;span className="accent-text"&gt;Store&lt;/span&gt; &lt;/span&gt; &lt;/div&gt; );
        const LoadingSpinner = ()-&gt; ( &lt;div className="bg-primary min-h-screen flex items-center justify-center"&gt;&lt;div className="animate-spin rounded-full h-32 w-32 border-t-4 border-b-4 accent-border"&gt;&lt;/div&gt;&lt;/div&gt; );
        const Modal = ({ children, onClose, size = 'max-w-md' }) =&gt; ( &lt;div className="fixed inset-0 bg-black bg-opacity-75 z-50 flex justify-center items-center p-4 transition-opacity duration-300"&gt; &lt;div className={`bg-secondary rounded-2xl shadow-2xl p-6 md:p-8 w-full ${size} relative border-color transform transition-transform duration-300 scale-95 animate-scale-in`}&gt; &lt;button onClick={onClose} className="absolute top-4 right-4 text-secondary hover:text-primary transition-colors z-10"&gt; &lt;svg xmlns="http://www.w3.org/2000/svg" className="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"&gt;&lt;path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" /&gt;&lt;/svg&gt; &lt;/button&gt; {children} &lt;/div&gt; &lt;style&gt;{` @keyframes scale-in { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } } .animate-scale-in { animation: scale-in 0.3s ease-out forwards; } `}&lt;/style&gt; &lt;/div&gt; );
        const AlertModal = ({ message, onConfirm, onCancel, t }) =&gt; ( &lt;Modal onClose={onCancel}&gt; &lt;div className="text-center"&gt; &lt;h2 className="text-2xl font-bold text-primary mb-4"&gt;{t.confirmation}&lt;/h2&gt; &lt;p className="text-secondary mb-6"&gt;{message}&lt;/p&gt; &lt;div className={`flex ${onConfirm ? 'justify-between' : 'justify-center'} space-x-4`}&gt; &lt;button onClick={onCancel} className="bg-tertiary hover:bg-gray-700 text-primary font-bold py-2 px-6 rounded-lg transition-colors"&gt;{onConfirm ? t.cancel : t.ok}&lt;/button&gt; {onConfirm &amp;&amp; ( &lt;button onClick={onConfirm} className="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-6 rounded-lg transition-colors"&gt;{t.confirm}&lt;/button&gt; )} &lt;/div&gt; &lt;/div&gt; &lt;/Modal&gt; );
        
        const ProfileModal = ({ user, onClose, t, setAlertInfo }) =&gt; {
            const [isUploading, setIsUploading] = useState(false);
            const [color, setColor] = useState('#8b5cf6');
            const fileInputRef = useRef(null);

            const handleImageUpload = async (file) =&gt; {
                if (!file) return;
                if (!IMGBB_API_KEY) { setAlertInfo({ message: t.noApiKey }); return; }
                setIsUploading(true);
                const formData = new FormData();
                formData.append('image', file);

                try {
                    const response = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`, { method: 'POST', body: formData });
                    const result = await response.json();
                    if (result.success) {
                        await updateProfile(auth.currentUser, { photoURL: result.data.url });
                        setAlertInfo({ message: t.avatarUpdated });
                    } else { throw new Error(result.error.message); }
                } catch (error) { setAlertInfo({ message: `${t.errorOccurred}: ${error.message}` }); } 
                finally { setIsUploading(false); onClose(); }
            };
            
            const handleColorAvatar = async () =&gt; {
                const colorHex = color.substring(1);
                const photoURL = `https://placehold.co/128x128/${colorHex}/FFFFFF?text=${user.displayName.charAt(0)}`;
                try {
                    await updateProfile(auth.currentUser, { photoURL });
                    setAlertInfo({ message: t.avatarUpdated });
                } catch(error) { setAlertInfo({ message: t.errorOccurred }); }
                finally { onClose(); }
            };

            const handleRevertAvatar = async () =&gt; {
                const originalPhotoURL = auth.currentUser.providerData[0]?.photoURL;
                if (originalPhotoURL) {
                    try {
                        await updateProfile(auth.currentUser, { photoURL: originalPhotoURL });
                        setAlertInfo({ message: t.avatarReverted });
                    } catch (error) { setAlertInfo({ message: t.errorOccurred }); } 
                    finally { onClose(); }
                }
            };

            return (
                &lt;Modal onClose={onClose}&gt;
                    &lt;div className="text-center text-primary"&gt;
                        &lt;h2 className="text-3xl font-bold mb-4"&gt;{t.profile}&lt;/h2&gt;
                        &lt;img src={user.photoURL} alt={user.displayName} className="w-24 h-24 rounded-full mx-auto mb-4 border-4 accent-border object-cover"/&gt;
                        &lt;p className="text-xl mb-2"&gt;{user.displayName}&lt;/p&gt;
                        &lt;p className="text-secondary mb-6"&gt;{user.email}&lt;/p&gt;
                        &lt;div className="space-y-3"&gt;
                            &lt;button onClick={() =&gt; fileInputRef.current.click()} className="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition-colors"&gt;{t.uploadAvatar}&lt;/button&gt;
                            &lt;div className="flex items-center space-x-2"&gt;
                                &lt;button onClick={handleColorAvatar} className="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition-colors"&gt;{t.setColorAvatar}&lt;/button&gt;
                                &lt;input type="color" value={color} onChange={e =&gt; setColor(e.target.value)} className="p-1 h-10 w-14 block bg-tertiary border-color cursor-pointer rounded-lg"/&gt;
                            &lt;/div&gt;
                            &lt;button onClick={handleRevertAvatar} className="w-full bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg transition-colors"&gt;{t.revertAvatar}&lt;/button&gt;
                        &lt;/div&gt;
                        &lt;input type="file" ref={fileInputRef} onChange={(e) =&gt; handleImageUpload(e.target.files[0])} accept="image/*" className="hidden"/&gt;
                        {isUploading &amp;&amp; &lt;p className="accent-text mt-4"&gt;{t.uploadingAvatar}...&lt;/p&gt;}
                    &lt;/div&gt;
                &lt;/Modal&gt;
            );
        };

        const CustomSelector = ({ value, onChange, options }) =&gt; {
            const [isOpen, setIsOpen] = useState(false);
            const wrapperRef = useRef(null);

            useEffect(() =&gt; {
                function handleClickOutside(event) {
                    if (wrapperRef.current &amp;&amp; !wrapperRef.current.contains(event.target)) { setIsOpen(false); }
                }
                document.addEventListener("mousedown", handleClickOutside);
                return () =&gt; document.removeEventListener("mousedown", handleClickOutside);
            }, [wrapperRef]);

            const handleSelect = (newValue) =&gt; {
                onChange({ target: { value: newValue } });
                setIsOpen(false);
            };

            return (
                &lt;div className="relative" ref={wrapperRef}&gt;
                    &lt;button onClick={() =&gt; setIsOpen(!isOpen)} className="flex items-center justify-between w-full bg-tertiary hover:bg-gray-700 text-primary font-semibold py-2 px-4 rounded-lg transition-colors"&gt;
                        &lt;span&gt;{options.find(o =&gt; o.value === value).label}&lt;/span&gt;
                        &lt;svg className={`w-4 h-4 transition-transform ${isOpen ? 'transform rotate-180' : ''}`} fill="none" stroke="currentColor" viewBox="0 0 24 24"&gt;&lt;path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 9l-7 7-7-7"&gt;&lt;/path&gt;&lt;/svg&gt;
                    &lt;/button&gt;
                    {isOpen &amp;&amp; (
                        &lt;div className="absolute right-0 mt-2 w-full bg-tertiary rounded-md shadow-lg py-1 z-50 border-color"&gt;
                            {options.map(opt =&gt; (
                                &lt;a href="#" key={opt.value} onClick={(e) =&gt; { e.preventDefault(); handleSelect(opt.value); }}
                                   className={`block px-4 py-2 text-sm text-secondary hover:text-primary hover:accent-bg ${value === opt.value ? 'accent-bg text-white' : ''}`}&gt;
                                    {opt.label}
                                &lt;/a&gt;
                            ))}
                        &lt;/div&gt;
                    )}
                &lt;/div&gt;
            );
        };

        // --- Main Components ---
        function Header({ user, onLogin, onLogout, setPage, isAdmin, t, currency, setCurrency, language, setLanguage, setProfileVisible, theme, setTheme }) {
            const [userDropdownOpen, setUserDropdownOpen] = useState(false);
            const userDropdownRef = useRef(null);

            const langOptions = [{value: 'ru', label: t.russian}, {value: 'en', label: t.english}, {value: 'uz', label: t.uzbek}];
            const currencyOptions = [{value: 'RUB', label: t.ruble}, {value: 'USD', label: t.dollar}, {value: 'UZS', label: t.sum}];
            const themeOptions = [{value: 'dark', label: t.darkTheme}, {value: 'light', label: t.lightTheme}, {value: 'asonik', label: t.asonikTheme}];

            useEffect(() =&gt; {
                function handleClickOutside(event) {
                    if (userDropdownRef.current &amp;&amp; !userDropdownRef.current.contains(event.target)) { setUserDropdownOpen(false); }
                }
                document.addEventListener("mousedown", handleClickOutside);
                return () =&gt; document.removeEventListener("mousedown", handleClickOutside);
            }, [userDropdownRef]);

            return (
                &lt;header className="bg-secondary p-4 shadow-lg sticky top-0 z-40 border-b border-color"&gt;
                    &lt;div className="container mx-auto flex justify-between items-center"&gt;
                        &lt;div onClick={() =&gt; setPage('home')}&gt;&lt;Logo /&gt;&lt;/div&gt;
                        &lt;nav className="hidden md:flex items-center space-x-6"&gt;
                            &lt;button onClick={() =&gt; setPage('home')} className="text-secondary hover:text-primary font-medium transition-colors"&gt;{t.home}&lt;/button&gt;
                            &lt;button onClick={() =&gt; setPage('support')} className="text-secondary hover:text-primary font-medium transition-colors"&gt;{t.support}&lt;/button&gt;
                            &lt;button onClick={() =&gt; setPage('faq')} className="text-secondary hover:text-primary font-medium transition-colors"&gt;{t.faq}&lt;/button&gt;
                            {isAdmin &amp;&amp; &lt;button onClick={() =&gt; setPage('admin')} className="text-red-500 hover:text-red-400 font-bold transition-colors"&gt;{t.adminPanelTitle}&lt;/button&gt;}
                        &lt;/nav&gt;
                        &lt;div className="flex items-center space-x-2 sm:space-x-4"&gt;
                            &lt;div className="w-28"&gt;&lt;CustomSelector value={language} onChange={e =&gt; setLanguage(e.target.value)} options={langOptions} /&gt;&lt;/div&gt;
                            &lt;div className="w-28"&gt;&lt;CustomSelector value={currency} onChange={e =&gt; setCurrency(e.target.value)} options={currencyOptions} /&gt;&lt;/div&gt;
                            &lt;div className="w-32"&gt;&lt;CustomSelector value={theme} onChange={e =&gt; setTheme(e.target.value)} options={themeOptions} /&gt;&lt;/div&gt;
                            
                            {user ? (
                                &lt;div className="relative" ref={userDropdownRef}&gt;
                                    &lt;button onClick={() =&gt; setUserDropdownOpen(!userDropdownOpen)} className="flex items-center space-x-2"&gt;
                                        &lt;img src={user.photoURL} alt={user.displayName} className="h-10 w-10 rounded-full border-2 accent-border object-cover" /&gt;
                                        &lt;svg className={`w-4 h-4 text-primary transition-transform ${userDropdownOpen ? 'transform rotate-180' : ''}`} fill="none" stroke="currentColor" viewBox="0 0 24 24"&gt;&lt;path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 9l-7 7-7-7"&gt;&lt;/path&gt;&lt;/svg&gt;
                                    &lt;/button&gt;
                                    {userDropdownOpen &amp;&amp; (
                                        &lt;div className={`absolute right-0 mt-2 w-48 bg-secondary rounded-md shadow-lg py-1 z-50 border-color`}&gt;
                                            &lt;a href="#" onClick={(e) =&gt; { e.preventDefault(); setProfileVisible(true); setUserDropdownOpen(false); }} className="block px-4 py-2 text-sm text-secondary hover:text-primary hover:accent-bg"&gt;{t.profile}&lt;/a&gt;
                                            &lt;a href="#" onClick={(e) =&gt; { e.preventDefault(); onLogout(); setUserDropdownOpen(false); }} className="block px-4 py-2 text-sm text-secondary hover:text-primary hover:accent-bg"&gt;{t.logout}&lt;/a&gt;
                                        &lt;/div&gt;
                                    )}
                                &lt;/div&gt;
                            ) : (
                                &lt;button onClick={onLogin} className="accent-bg hover:accent-bg-secondary text-white font-bold py-2 px-4 rounded-lg transition-transform transform hover:scale-105 flex items-center space-x-2"&gt;
                                    &lt;span&gt;{t.login}&lt;/span&gt;
                                &lt;/button&gt;
                            )}
                        &lt;/div&gt;
                    &lt;/div&gt;
                &lt;/header&gt;
            );
        }
        
        const SkeletonCard = () =&gt; (
            &lt;div className="bg-secondary rounded-2xl overflow-hidden shadow-lg border-color animate-pulse"&gt;
                &lt;div className="w-full h-56 bg-tertiary"&gt;&lt;/div&gt;
                &lt;div className="p-6"&gt;
                    &lt;div className="h-8 bg-tertiary rounded w-3/4 mb-2"&gt;&lt;/div&gt;
                    &lt;div className="h-6 bg-tertiary rounded w-1/2 mb-4"&gt;&lt;/div&gt;
                    &lt;div className="h-10 bg-tertiary rounded w-1/3"&gt;&lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        );
        
        function HomePage({ products, onProductClick, t, currency, convertPrice, loading }) {
            const [searchTerm, setSearchTerm] = useState('');
            const [filterCategory, setFilterCategory] = useState('all');
            const [sortBy, setSortBy] = useState('new');

            const filteredAndSortedProducts = useMemo(() =&gt; {
                return products
                    .filter(p =&gt; p.name.toLowerCase().includes(searchTerm.toLowerCase()))
                    .filter(p =&gt; filterCategory === 'all' || p.category === filterCategory)
                    .sort((a, b) =&gt; {
                        if (a.pinned &amp;&amp; !b.pinned) return -1;
                        if (!a.pinned &amp;&amp; b.pinned) return 1;
                        if (sortBy === 'popular') return (b.popularity || 0) - (a.popularity || 0);
                        return (b.createdAt?.toMillis() || 0) - (a.createdAt?.toMillis() || 0);
                    });
            }, [products, searchTerm, filterCategory, sortBy]);

            const FilterButton = ({ value, state, setState, children }) =&gt; (
                &lt;button onClick={() =&gt; setState(value)} className={`px-4 py-2 rounded-lg text-sm transition-colors ${state === value ? 'accent-bg text-white' : 'bg-tertiary text-primary hover:bg-gray-600'}`}&gt;
                    {children}
                &lt;/button&gt;
            );

            const categories = useMemo(() =&gt; {
                const cats = { all: t.all };
                products.forEach(p =&gt; { if (p.category) cats[p.category] = p.category; });
                return Object.keys(cats).map(key =&gt; ({ value: key, label: t[key.toLowerCase()] || key }));
            }, [products, t]);

            return (
                &lt;main className="container mx-auto p-4 md:p-8"&gt;
                    &lt;h1 className="text-4xl md:text-5xl font-black text-primary text-center mb-4 tracking-wide"&gt;{t.catalogTitle}&lt;/h1&gt;
                    &lt;p className="accent-text text-center mb-8 text-lg"&gt;{t.catalogSubtitle}&lt;/p&gt;
                    
                    &lt;div className="bg-secondary p-4 rounded-xl mb-8 flex flex-col md:flex-row gap-4 items-center"&gt;
                        &lt;input type="text" placeholder={t.searchPlaceholder} value={searchTerm} onChange={e =&gt; setSearchTerm(e.target.value)} className="w-full md:w-1/3 p-3 bg-tertiary rounded-lg border-color focus:outline-none focus:ring-2 accent-border text-primary" /&gt;
                        &lt;div className="flex items-center gap-2"&gt;
                            &lt;span className="text-secondary font-semibold"&gt;{t.category}:&lt;/span&gt;
                            &lt;div className="w-40"&gt;&lt;CustomSelector value={filterCategory} onChange={e =&gt; setFilterCategory(e.target.value)} options={categories} /&gt;&lt;/div&gt;
                        &lt;/div&gt;
                        &lt;div className="flex items-center gap-2 ml-auto"&gt;
                            &lt;span className="text-secondary font-semibold"&gt;{t.sortBy}:&lt;/span&gt;
                            &lt;FilterButton value="new" state={sortBy} setState={setSortBy}&gt;{t.newSort}&lt;/FilterButton&gt;
                            &lt;FilterButton value="popular" state={sortBy} setState={setSortBy}&gt;{t.popularSort}&lt;/FilterButton&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                    
                    {loading ? (
                         &lt;div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"&gt;
                            {[...Array(6)].map((_, i) =&gt; &lt;SkeletonCard key={i} /&gt;)}
                        &lt;/div&gt;
                    ) : filteredAndSortedProducts.length === 0 ? (
                         &lt;p className="text-center text-secondary text-xl mt-12"&gt;{t.productsNotFound}&lt;/p&gt;
                    ) : (
                        &lt;div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"&gt;
                            {filteredAndSortedProducts.map(product =&gt; (
                                &lt;ProductCard key={product.id} {...{product, onProductClick, t, currency, convertPrice}} /&gt;
                            ))}
                        &lt;/div&gt;
                    )}
                &lt;/main&gt;
            );
        }

        function ProductCard({ product, onProductClick, t, currency, convertPrice }) {
            return (
                &lt;div onClick={() =&gt; onProductClick(product)} className="bg-secondary rounded-2xl overflow-hidden shadow-lg border-color transform hover:-translate-y-2 transition-transform duration-300 flex flex-col cursor-pointer relative"&gt;
                    {product.pinned &amp;&amp; &lt;div className="absolute top-0 right-0 accent-bg text-white text-xs font-bold px-3 py-1 rounded-bl-lg z-10"&gt;{t.pinned}&lt;/div&gt;}
                    &lt;img className="w-full h-56 object-cover" src={product.imageUrl} alt={product.name} onError={(e) =&gt; { e.target.onerror = null; e.target.src=`https://placehold.co/600x400/1f2937/374151?text=${encodeURIComponent(t.imageNotFound)}`; }}/&gt;
                    &lt;div className="p-6 flex flex-col flex-grow"&gt;
                        {product.isVerified &amp;&amp; (
                            &lt;div className="flex items-center text-green-400 text-sm mb-2"&gt;
                                &lt;svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor"&gt;&lt;path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" /&gt;&lt;/svg&gt;
                                {t.verifiedByStore}
                            &lt;/div&gt;
                        )}
                        &lt;h3 className="text-2xl font-bold text-primary mb-1"&gt;{product.name}&lt;/h3&gt;
                        {product.nominal &amp;&amp; &lt;p className="accent-text font-semibold mb-2"&gt;{product.nominal}&lt;/p&gt;}
                        &lt;div className="flex-grow"&gt;&lt;/div&gt;
                        &lt;div className="flex justify-between items-center mt-4"&gt;
                            &lt;span className="text-3xl font-bold accent-text"&gt;{convertPrice(product.price, currency)}&lt;/span&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            );
        }

        function ProductModal({ product, user, onClose, onBuy, setAlertInfo, t, currency, convertPrice }) {
             const handleShare = () =&gt; {
                const productUrl = `${window.location.origin}${window.location.pathname}?product=${product.id}`;
                navigator.clipboard.writeText(productUrl).then(() =&gt; {
                    setAlertInfo({ message: t.linkCopied });
                }, () =&gt; {
                    const dummy = document.createElement('textarea');
                    document.body.appendChild(dummy);
                    dummy.value = productUrl;
                    dummy.select();
                    document.execCommand('copy');
                    document.body.removeChild(dummy);
                    setAlertInfo({ message: t.linkCopied });
                });
            };

            const handleBuyClick = () =&gt; {
                if (user) {
                    onBuy(product);
                } else {
                    setAlertInfo({ message: t.loginToBuy });
                }
            };

            return (
                &lt;Modal onClose={onClose} size="max-w-4xl"&gt;
                    &lt;div className="grid grid-cols-1 md:grid-cols-2 gap-8"&gt;
                        &lt;img src={product.imageUrl} alt={product.name} className="w-full h-auto object-cover rounded-lg"/&gt;
                        &lt;div className="flex flex-col"&gt;
                            {product.isVerified &amp;&amp; (
                                &lt;div className="flex items-center text-green-400 text-sm mb-2"&gt;
                                    &lt;svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor"&gt;&lt;path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" /&gt;&lt;/svg&gt;
                                    {t.verifiedByStore}
                                &lt;/div&gt;
                            )}
                            &lt;h2 className="text-4xl font-bold text-primary mb-2"&gt;{product.name}&lt;/h2&gt;
                            {product.nominal &amp;&amp; &lt;p className="text-xl accent-text font-semibold mb-4"&gt;{product.nominal}&lt;/p&gt;}
                            &lt;p className="text-secondary mb-6 flex-grow"&gt;{product.description}&lt;/p&gt;
                            &lt;div className="flex justify-between items-center"&gt;
                                &lt;span className="text-5xl font-bold accent-text"&gt;{convertPrice(product.price, currency)}&lt;/span&gt;
                                &lt;div className="flex space-x-2"&gt;
                                    &lt;button onClick={handleShare} className="bg-tertiary hover:bg-gray-700 p-4 rounded-lg transition-colors"&gt;
                                        &lt;svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6 text-primary" viewBox="0 0 20 20" fill="currentColor"&gt;&lt;path d="M15 8a3 3 0 10-2.977-2.63l-4.94 2.47a3 3 0 100 4.319l4.94 2.47a3 3 0 10.895-1.789l-4.94-2.47a3.027 3.027 0 000-.74l4.94-2.47C13.456 7.68 14.19 8 15 8z" /&gt;&lt;/svg&gt;
                                    &lt;/button&gt;
                                    &lt;button onClick={handleBuyClick} className="accent-bg hover:accent-bg-secondary text-white font-bold py-4 px-8 rounded-lg text-lg"&gt;{t.buy}&lt;/button&gt;
                                &lt;/div&gt;
                            &lt;/div&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                &lt;/Modal&gt;
            );
        }

        function PurchaseModal({ product, onClose, onConfirm, onYooMoney, t, currency, convertPrice, setAlertInfo }) {
            const [promoCode, setPromoCode] = useState('');
            const [appliedPromo, setAppliedPromo] = useState(null);
            const [error, setError] = useState('');

            const finalPrice = useMemo(() =&gt; {
                if (!appliedPromo) return product.price;
                return product.price * (1 - appliedPromo.discount / 100);
            }, [product.price, appliedPromo]);

            const handleApplyPromo = async () =&gt; {
                setError('');
                if (!promoCode.trim()) return;
                
                const promoRef = doc(db, 'promoCodes', promoCode);
                const promoSnap = await getDoc(promoRef);

                if (promoSnap.exists()) {
                    const promoData = promoSnap.data();
                    if (promoData.timesUsed &gt;= promoData.usageLimit) {
                        setError(t.promoLimitReached);
                        setAppliedPromo(null);
                    } else {
                        setAppliedPromo(promoData);
                        setAlertInfo({ message: t.promoApplied });
                    }
                } else {
                    setAppliedPromo(null);
                    setError(t.promoNotFound);
                }
            };

            const handleContactSeller = async () =&gt; {
                const purchaseDetails = {
                    finalPrice,
                    promoCodeUsed: appliedPromo ? appliedPromo.code : null,
                    paymentMethod: 'Telegram'
                };
                await onConfirm(product, purchaseDetails);
                window.open('https://t.me/asonikofficial', '_blank');
                onClose();
            };

            const handleYooMoneyClick = () =&gt; {
                const purchaseDetails = {
                    finalPrice,
                    promoCodeUsed: appliedPromo ? appliedPromo.code : null,
                    paymentMethod: 'YooMoney'
                };
                onYooMoney(product, purchaseDetails);
                onClose();
            };

            return (
                &lt;Modal onClose={onClose}&gt;
                    &lt;div className="text-center"&gt;
                        &lt;h2 className="text-3xl font-bold text-primary mb-2"&gt;{t.checkout}&lt;/h2&gt;
                        &lt;p className="text-secondary mb-4"&gt;{t.youAreBuying}: &lt;span className="font-bold accent-text"&gt;{product.name}&lt;/span&gt;&lt;/p&gt;
                        
                        &lt;div className="my-4"&gt;
                            {appliedPromo ? (
                                &lt;div&gt;
                                    &lt;span className="text-2xl text-secondary line-through"&gt;{convertPrice(product.price, currency)}&lt;/span&gt;
                                    &lt;span className="text-4xl font-bold accent-text ml-2"&gt;{convertPrice(finalPrice, currency)}&lt;/span&gt;
                                &lt;/div&gt;
                            ) : (
                                &lt;span className="text-4xl font-bold accent-text"&gt;{convertPrice(product.price, currency)}&lt;/span&gt;
                            )}
                        &lt;/div&gt;

                        &lt;div className="space-y-4"&gt;
                            &lt;h3 className="text-xl text-primary"&gt;{t.choosePayment}&lt;/h3&gt;
                            &lt;div className="bg-tertiary p-4 rounded-lg"&gt;
                                &lt;label className="block text-secondary text-sm font-bold mb-2"&gt;{t.payWithPromo}&lt;/label&gt;
                                &lt;div className="flex space-x-2"&gt;
                                    &lt;input type="text" value={promoCode} onChange={(e) =&gt; setPromoCode(e.target.value.toUpperCase())} placeholder={t.promoCodeName} className="w-full p-2 bg-primary rounded-lg border-color text-primary"/&gt;
                                    &lt;button onClick={handleApplyPromo} className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg"&gt;{t.apply}&lt;/button&gt;
                                &lt;/div&gt;
                                {error &amp;&amp; &lt;p className="text-red-500 text-sm mt-2"&gt;{error}&lt;/p&gt;}
                                {appliedPromo &amp;&amp; &lt;p className="text-green-500 text-sm mt-2"&gt;{t.promoApplied}: {appliedPromo.discount}%&lt;/p&gt;}
                            &lt;/div&gt;

                            &lt;button onClick={handleContactSeller} className="w-full bg-teal-500 hover:bg-teal-600 text-white font-bold py-3 px-4 rounded-lg transition-transform transform hover:scale-105"&gt;{t.contactSeller}&lt;/button&gt;
                            &lt;button onClick={handleYooMoneyClick} className="w-full bg-yellow-500 hover:bg-yellow-600 text-black font-bold py-3 px-4 rounded-lg transition-transform transform hover:scale-105"&gt;YooMoney&lt;/button&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                &lt;/Modal&gt;
            );
        }

        // --- NEW: YooMoney Payment Modal ---
        function YooMoneyModal({ data, onClose, onConfirm, t, currency, convertPrice }) {
            const { product, purchaseDetails } = data;

            const handleConfirm = async () =&gt; {
                await onConfirm(product, purchaseDetails);
                window.open('https://t.me/asonikofficial', '_blank');
                onClose();
            };

            return (
                &lt;Modal onClose={onClose} size="max-w-lg"&gt;
                    &lt;div className="text-center"&gt;
                        &lt;h2 className="text-2xl font-bold text-primary mb-4"&gt;{t.yooMoneyPayment}&lt;/h2&gt;
                        &lt;p className="text-secondary mb-4"&gt;{t.yooMoneyInstruction}&lt;/p&gt;
                        
                        &lt;img src={qrCodeBase64} alt="YooMoney QR Code" className="w-48 h-48 mx-auto my-4 border-4 border-white rounded-lg"/&gt;
                        
                        &lt;div className="my-4"&gt;
                            &lt;p className="text-secondary"&gt;{t.amountToPay}:&lt;/p&gt;
                            &lt;p className="text-3xl font-bold accent-text"&gt;{convertPrice(purchaseDetails.finalPrice, currency)}&lt;/p&gt;
                        &lt;/div&gt;
                        
                        &lt;div className="bg-tertiary p-3 rounded-lg"&gt;
                            &lt;p className="text-secondary text-sm"&gt;{t.orPayWithLink}:&lt;/p&gt;
                            &lt;a href="https://yoomoney.ru/to/4100118308403073/0" target="_blank" rel="noopener noreferrer" className="text-blue-400 hover:underline break-words"&gt;
                                https://yoomoney.ru/to/4100118308403073/0
                            &lt;/a&gt;
                        &lt;/div&gt;

                        &lt;p className="text-secondary my-6"&gt;{t.afterPaymentInstruction}&lt;/p&gt;
                        
                        &lt;button onClick={handleConfirm} className="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg transition-colors"&gt;
                            {t.iPaidSendScreenshot}
                        &lt;/button&gt;
                    &lt;/div&gt;
                &lt;/Modal&gt;
            );
        }

        function ChatModal({ ticketId, user, isAdmin, onClose, t }) {
            const [messages, setMessages] = useState([]);
            const [newMessage, setNewMessage] = useState('');
            const chatEndRef = useRef(null);

            useEffect(() =&gt; {
                if (!ticketId) return;
                const messagesQuery = query(collection(db, 'supportTickets', ticketId, 'messages'), orderBy('timestamp'));
                const unsubscribe = onSnapshot(messagesQuery, snapshot =&gt; { setMessages(snapshot.docs.map(doc =&gt; doc.data())); });
                return unsubscribe;
            }, [ticketId]);

            useEffect(() =&gt; { chatEndRef.current?.scrollIntoView({ behavior: 'smooth' }); }, [messages]);

            const handleSendMessage = async (e) =&gt; {
                e.preventDefault();
                if (!newMessage.trim()) return;
                await addDoc(collection(db, 'supportTickets', ticketId, 'messages'), {
                    text: newMessage, senderId: user.uid, senderName: isAdmin ? 'Admin' : user.displayName, timestamp: serverTimestamp()
                });
                await updateDoc(doc(db, 'supportTickets', ticketId), {
                    lastMessage: newMessage, lastUpdated: serverTimestamp(), status: isAdmin ? 'answered' : 'pending'
                });
                setNewMessage('');
            };

            return (
                &lt;Modal onClose={onClose} size="max-w-2xl"&gt;
                    &lt;div className="flex flex-col h-[70vh]"&gt;
                        &lt;h2 className="text-2xl font-bold text-primary mb-4 text-center"&gt;{t.chatWithAdmin}&lt;/h2&gt;
                        &lt;div className="flex-grow bg-primary rounded-lg p-4 overflow-y-auto mb-4"&gt;
                            {messages.map((msg, index) =&gt; (
                                &lt;div key={index} className={`flex my-2 ${msg.senderId === user.uid ? 'justify-end' : 'justify-start'}`}&gt;
                                    &lt;div className={`chat-bubble rounded-lg p-3 text-white ${msg.senderId === user.uid ? 'chat-bubble-user' : 'chat-bubble-admin'}`}&gt;
                                        &lt;p className="font-bold text-sm"&gt;{msg.senderName}&lt;/p&gt;
                                        &lt;p&gt;{msg.text}&lt;/p&gt;
                                        &lt;p className="text-xs text-gray-400 text-right mt-1"&gt;{msg.timestamp ? new Date(msg.timestamp.toDate()).toLocaleTimeString() : '...'}&lt;/p&gt;
                                    &lt;/div&gt;
                                &lt;/div&gt;
                            ))}
                            &lt;div ref={chatEndRef} /&gt;
                        &lt;/div&gt;
                        &lt;form onSubmit={handleSendMessage} className="flex space-x-2"&gt;
                            &lt;input type="text" value={newMessage} onChange={e =&gt; setNewMessage(e.target.value)} placeholder={t.enterMessagePlaceholder} className="w-full p-3 bg-tertiary rounded-lg border-color focus:outline-none focus:ring-2 accent-ring text-primary" /&gt;
                            &lt;button type="submit" className="accent-bg hover:accent-bg-secondary text-white font-bold p-3 rounded-lg"&gt;&lt;svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"&gt;&lt;path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" /&gt;&lt;/svg&gt;&lt;/button&gt;
                        &lt;/form&gt;
                    &lt;/div&gt;
                &lt;/Modal&gt;
            );
        }

        function SupportPage({ user, t, setActiveTicketId }) {
            const handleCreateTicket = async () =&gt; {
                const ticketRef = doc(db, 'supportTickets', user.uid);
                const ticketSnap = await getDoc(ticketRef);
                if (!ticketSnap.exists()) {
                    await setDoc(ticketRef, {
                        userId: user.uid, userEmail: user.email, userName: user.displayName,
                        subject: `${t.chatWith} ${user.displayName}`, status: 'new',
                        lastUpdated: serverTimestamp(), createdAt: serverTimestamp()
                    });
                }
                setActiveTicketId(user.uid);
            };
            
            return (
                &lt;div className="container mx-auto p-4 md:p-8 text-primary flex justify-center items-center h-full"&gt;
                    &lt;div className="text-center"&gt;
                        &lt;h1 className="text-4xl font-bold mb-4"&gt;{t.support}&lt;/h1&gt;
                        &lt;p className="text-secondary mb-8"&gt;{t.supportSubtitle}&lt;/p&gt;
                        &lt;button onClick={handleCreateTicket} className="accent-bg hover:accent-bg-secondary text-white font-bold py-3 px-6 rounded-lg text-lg"&gt;
                            {t.chatWithAdmin}
                        &lt;/button&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            );
        }

        function FAQPage({ faqs, t }) {
            const [openIndex, setOpenIndex] = useState(null);
            return (
                &lt;div className="container mx-auto p-4 md:p-8"&gt;
                    &lt;h1 className="text-4xl font-bold text-center mb-8 text-primary"&gt;{t.faqTitle}&lt;/h1&gt;
                    &lt;div className="space-y-4 max-w-3xl mx-auto"&gt;
                        {faqs.map((faq, index) =&gt; (
                            &lt;div key={faq.id} className="bg-secondary rounded-lg"&gt;
                                &lt;button onClick={() =&gt; setOpenIndex(openIndex === index ? null : index)} className="w-full text-left p-4 flex justify-between items-center"&gt;
                                    &lt;span className="font-semibold text-primary"&gt;{faq.question}&lt;/span&gt;
                                    &lt;svg className={`w-6 h-6 transform transition-transform text-primary ${openIndex === index ? 'rotate-180' : ''}`} fill="none" stroke="currentColor" viewBox="0 0 24 24"&gt;&lt;path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 9l-7 7-7-7"&gt;&lt;/path&gt;&lt;/svg&gt;
                                &lt;/button&gt;
                                {openIndex === index &amp;&amp; ( &lt;div className="p-4 border-t border-color text-secondary"&gt; {faq.answer} &lt;/div&gt; )}
                            &lt;/div&gt;
                        ))}
                    &lt;/div&gt;
                &lt;/div&gt;
            );
        }

        function AdminPage({ products, faqs, setAlertInfo, t, setActiveTicketId, handleDeleteProduct }) {
            const [view, setView] = useState('dashboard');
            const [tickets, setTickets] = useState([]);
            const [orders, setOrders] = useState([]);
            const [name, setName] = useState('');
            const [description, setDescription] = useState('');
            const [price, setPrice] = useState('');
            const [imageUrl, setImageUrl] = useState('');
            const [isPinned, setIsPinned] = useState(false);
            const [isVerified, setIsVerified] = useState(false); // New state for verified badge
            const [category, setCategory] = useState('');
            const [nominal, setNominal] = useState('');
            const [editingProduct, setEditingProduct] = useState(null);
            const [orderFilter, setOrderFilter] = useState('all');
            const [isLoading, setIsLoading] = useState(false);
            const fileInputRef = useRef(null);
            const [faqQuestion, setFaqQuestion] = useState('');
            const [faqAnswer, setFaqAnswer] = useState('');
            const [editingFaq, setEditingFaq] = useState(null);
            const [promoCodes, setPromoCodes] = useState([]);
            const [promoCodeName, setPromoCodeName] = useState('');
            const [promoDiscount, setPromoDiscount] = useState(10);
            const [promoUsageLimit, setPromoUsageLimit] = useState(100);

            useEffect(() =&gt; {
                const ticketsQuery = query(collection(db, 'supportTickets'), orderBy('lastUpdated', 'desc'));
                const unsubTickets = onSnapshot(ticketsQuery, snapshot =&gt; setTickets(snapshot.docs.map(doc =&gt; ({ id: doc.id, ...doc.data() }))));
                
                const ordersQuery = query(collection(db, 'orders'), orderBy('timestamp', 'desc'));
                const unsubOrders = onSnapshot(ordersQuery, snapshot =&gt; setOrders(snapshot.docs.map(doc =&gt; ({ id: doc.id, ...doc.data() }))));

                const promoQuery = query(collection(db, 'promoCodes'), orderBy('createdAt', 'desc'));
                const unsubPromos = onSnapshot(promoQuery, snapshot =&gt; setPromoCodes(snapshot.docs.map(doc =&gt; ({ id: doc.id, ...doc.data() }))));

                return () =&gt; { unsubTickets(); unsubOrders(); unsubPromos(); };
            }, []);
            
            const filteredOrders = useMemo(() =&gt; {
                if (orderFilter === 'all') return orders;
                const now = new Date();
                const filterDate = new Date();
                if (orderFilter === 'today') filterDate.setHours(0, 0, 0, 0);
                else if (orderFilter === '3days') filterDate.setDate(now.getDate() - 3);
                else if (orderFilter === 'month') filterDate.setMonth(now.getMonth() - 1);
                return orders.filter(order =&gt; order.timestamp &amp;&amp; order.timestamp.toDate() &gt;= filterDate);
            }, [orders, orderFilter]);
            
            const resetForm = () =&gt; {
                setName(''); setDescription(''); setPrice(''); setNominal('');
                setImageUrl(''); setEditingProduct(null); setIsPinned(false); setIsVerified(false); setCategory('');
            };

             const handleImageUpload = async (file) =&gt; {
                if (!file) return;
                if (!IMGBB_API_KEY) { setAlertInfo({ message: t.noApiKey }); return; }
                setIsLoading(true);
                const formData = new FormData();
                formData.append('image', file);
                try {
                    const response = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`, { method: 'POST', body: formData });
                    const result = await response.json();
                    if (result.success) {
                        setImageUrl(result.data.url);
                        setAlertInfo({ message: t.imageUploaded });
                    } else { throw new Error(result.error.message); }
                } catch (error) { setAlertInfo({ message: `${t.errorOccurred}: ${error.message}` }); } 
                finally { setIsLoading(false); }
            };

            const handleSubmit = async (e) =&gt; {
                e.preventDefault();
                if (!name || !description || !price || !imageUrl) { setAlertInfo({ message: t.fillAllFields }); return; }
                setIsLoading(true);
                const productData = { 
                    name, description, price: Number(price), imageUrl, nominal, 
                    pinned: isPinned, isVerified: isVerified, // Save verified status
                    category, createdAt: serverTimestamp(), popularity: editingProduct?.popularity || 0 
                };
                try {
                    if (editingProduct) {
                        await setDoc(doc(db, 'products', editingProduct.id), productData, { merge: true });
                        setAlertInfo({ message: t.productUpdated });
                    } else {
                        await addDoc(collection(db, 'products'), productData);
                        setAlertInfo({ message: t.productAdded });
                    }
                    resetForm();
                    setView('viewProducts');
                } catch (error) { setAlertInfo({ message: t.errorOccurred }); }
                finally { setIsLoading(false); }
            };

            const handleDeleteOrder = (orderId) =&gt; {
                setAlertInfo({ message: t.confirmDeleteOrder, onConfirm: async () =&gt; {
                    try { await deleteDoc(doc(db, 'orders', orderId)); setAlertInfo({ message: t.orderDeleted }); } 
                    catch (error) { setAlertInfo({ message: t.errorOccurred }); }
                }});
            };
            
            const handleEdit = (product) =&gt; {
                setEditingProduct(product);
                setName(product.name); setDescription(product.description); setPrice(product.price);
                setNominal(product.nominal || ''); setIsPinned(product.pinned || false); setIsVerified(product.isVerified || false);
                setCategory(product.category || 'games'); setImageUrl(product.imageUrl);
                setView('addProduct');
            };
            
            const handleFaqSubmit = async (e) =&gt; {
                e.preventDefault();
                if (!faqQuestion || !faqAnswer) { setAlertInfo({ message: t.fillAllFields }); return; }
                const faqData = { question: faqQuestion, answer: faqAnswer };
                try {
                    if (editingFaq) {
                        await setDoc(doc(db, 'faq', editingFaq.id), faqData);
                        setAlertInfo({ message: t.faqUpdated });
                    } else {
                        await addDoc(collection(db, 'faq'), faqData);
                        setAlertInfo({ message: t.faqAdded });
                    }
                    setFaqQuestion(''); setFaqAnswer(''); setEditingFaq(null);
                } catch (error) { setAlertInfo({ message: t.errorOccurred }); }
            };

            const handleEditFaq = (faq) =&gt; { setEditingFaq(faq); setFaqQuestion(faq.question); setFaqAnswer(faq.answer); };

            const handleDeleteFaq = async (id) =&gt; {
                 setAlertInfo({ message: t.confirmDeleteFaq, onConfirm: async () =&gt; {
                    try { await deleteDoc(doc(db, 'faq', id)); setAlertInfo({ message: t.faqDeleted }); }
                    catch (error) { setAlertInfo({ message: t.errorOccurred }); }
                }});
            };

            const handlePromoSubmit = async (e) =&gt; {
                e.preventDefault();
                if (!promoCodeName.trim()) { setAlertInfo({ message: t.fillAllFields }); return; }
                const promoData = { 
                    code: promoCodeName.toUpperCase(), 
                    discount: Number(promoDiscount), 
                    usageLimit: Number(promoUsageLimit),
                    timesUsed: 0,
                    createdAt: serverTimestamp() 
                };
                try {
                    await setDoc(doc(db, 'promoCodes', promoData.code), promoData);
                    setAlertInfo({ message: t.promoAdded });
                    setPromoCodeName('');
                    setPromoDiscount(10);
                    setPromoUsageLimit(100);
                } catch (error) { setAlertInfo({ message: t.errorOccurred }); }
            };

            const handleDeletePromo = async (id) =&gt; {
                setAlertInfo({ message: t.confirmDeletePromo, onConfirm: async () =&gt; {
                    try { await deleteDoc(doc(db, 'promoCodes', id)); setAlertInfo({ message: t.promoDeleted }); }
                    catch (error) { setAlertInfo({ message: t.errorOccurred }); }
                }});
            };

            return (
                &lt;div className="container mx-auto p-4 md:p-8 text-primary"&gt;
                    &lt;h1 className="text-4xl font-bold mb-8 text-center"&gt;{t.adminPanelTitle}&lt;/h1&gt;

                    {view === 'dashboard' &amp;&amp; (
                        &lt;div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-8"&gt;
                            &lt;button onClick={() =&gt; setView('viewProducts')} className="bg-purple-600 hover:bg-purple-700 p-8 rounded-lg text-2xl font-bold text-white"&gt;{t.manageProducts}&lt;/button&gt;
                            &lt;button onClick={() =&gt; { setEditingProduct(null); resetForm(); setView('addProduct'); }} className="bg-green-600 hover:bg-green-700 p-8 rounded-lg text-2xl font-bold text-white"&gt;{t.addProduct}&lt;/button&gt;
                            &lt;button onClick={() =&gt; setView('manageFAQ')} className="bg-yellow-500 hover:bg-yellow-600 p-8 rounded-lg text-2xl font-bold text-white"&gt;{t.manageFaq}&lt;/button&gt;
                            &lt;button onClick={() =&gt; setView('managePromo')} className="bg-blue-600 hover:bg-blue-700 p-8 rounded-lg text-2xl font-bold text-white"&gt;{t.managePromoCodes}&lt;/button&gt;
                        &lt;/div&gt;
                    )}
                    
                    {view === 'addProduct' &amp;&amp; ( 
                        &lt;div&gt;
                            &lt;button onClick={() =&gt; setView('dashboard')} className="mb-4 bg-tertiary p-2 rounded-lg"&gt; {t.backToPanel}&lt;/button&gt;
                            &lt;div className="bg-secondary p-8 rounded-2xl border-color"&gt;
                                &lt;h2 className="text-2xl font-bold mb-6 text-primary"&gt;{editingProduct ? t.editProduct : t.addProduct}&lt;/h2&gt;
                                &lt;form onSubmit={handleSubmit} className="space-y-4"&gt;
                                    &lt;input type="text" placeholder={t.productName} value={name} onChange={e =&gt; setName(e.target.value)} className="w-full p-3 bg-tertiary rounded-lg border-color focus:outline-none focus:ring-2 accent-border text-primary" /&gt;
                                    &lt;input type="text" placeholder={t.productNominal} value={nominal} onChange={e =&gt; setNominal(e.target.value)} className="w-full p-3 bg-tertiary rounded-lg border-color focus:outline-none focus:ring-2 accent-border text-primary" /&gt;
                                    &lt;textarea placeholder={t.description} value={description} onChange={e =&gt; setDescription(e.target.value)} className="w-full p-3 bg-tertiary rounded-lg border-color focus:outline-none focus:ring-2 accent-border text-primary h-32"&gt;&lt;/textarea&gt;
                                    &lt;input type="number" placeholder={t.priceInRub} value={price} onChange={e =&gt; setPrice(e.target.value)} className="w-full p-3 bg-tertiary rounded-lg border-color focus:outline-none focus:ring-2 accent-border text-primary" /&gt;
                                    
                                    &lt;div className="space-y-2"&gt;
                                        &lt;label className="block text-secondary"&gt;{t.productImage}&lt;/label&gt;
                                        &lt;div className="flex items-center space-x-2"&gt;
                                            &lt;input type="text" placeholder={t.imageUrl} value={imageUrl} onChange={e =&gt; setImageUrl(e.target.value)} className="w-full p-3 bg-tertiary rounded-lg border-color focus:outline-none focus:ring-2 accent-border text-primary" /&gt;
                                            &lt;button type="button" onClick={() =&gt; fileInputRef.current.click()} className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg"&gt;{t.uploadFile}&lt;/button&gt;
                                        &lt;/div&gt;
                                        &lt;input type="file" ref={fileInputRef} onChange={(e) =&gt; handleImageUpload(e.target.files[0])} accept="image/*" className="hidden"/&gt;
                                    &lt;/div&gt;
                                    
                                    &lt;div className="flex justify-between items-center"&gt;
                                        &lt;div className="flex items-center space-x-3"&gt;
                                            &lt;label htmlFor="category" className="text-secondary"&gt;{t.category}:&lt;/label&gt;
                                            &lt;input type="text" id="category" value={category} onChange={e =&gt; setCategory(e.target.value)} className="p-2 bg-tertiary rounded-lg border-color text-primary" placeholder="e.g., Shooters"/&gt;
                                        &lt;/div&gt;
                                        &lt;div className="flex items-center space-x-3"&gt;
                                            &lt;input type="checkbox" id="isPinned" checked={isPinned} onChange={e =&gt; setIsPinned(e.target.checked)} className="h-5 w-5 rounded accent-bg focus:ring-purple-500"/&gt;
                                            &lt;label htmlFor="isPinned" className="text-secondary"&gt;{t.pinProduct}&lt;/label&gt;
                                        &lt;/div&gt;
                                        {/* New Checkbox for Verified */}
                                        &lt;div className="flex items-center space-x-3"&gt;
                                            &lt;input type="checkbox" id="isVerified" checked={isVerified} onChange={e =&gt; setIsVerified(e.target.checked)} className="h-5 w-5 rounded accent-bg focus:ring-purple-500"/&gt;
                                            &lt;label htmlFor="isVerified" className="text-secondary"&gt;{t.verifiedByStore}&lt;/label&gt;
                                        &lt;/div&gt;
                                    &lt;/div&gt;
                                    &lt;div className="flex space-x-4"&gt;
                                        &lt;button type="submit" disabled={isLoading} className="w-full accent-bg hover:accent-bg-secondary text-white font-bold py-3 px-4 rounded-lg transition-colors disabled:bg-gray-500"&gt;{isLoading ? t.loading : (editingProduct ? t.updateProduct : t.addProductBtn)}&lt;/button&gt;
                                        {editingProduct &amp;&amp; &lt;button type="button" onClick={resetForm} className="w-full bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-lg transition-colors"&gt;{t.cancel}&lt;/button&gt;}
                                    &lt;/div&gt;
                                &lt;/form&gt;
                            &lt;/div&gt;
                        &lt;/div&gt;
                    )}
                    {view === 'viewProducts' &amp;&amp; ( 
                        &lt;div&gt;
                            &lt;button onClick={() =&gt; setView('dashboard')} className="mb-4 bg-tertiary p-2 rounded-lg"&gt; {t.backToPanel}&lt;/button&gt;
                            &lt;div className="bg-secondary p-8 rounded-2xl border-color"&gt;
                                &lt;h2 className="text-2xl font-bold mb-6 text-primary"&gt;{t.productList}&lt;/h2&gt;
                                &lt;div className="space-y-4"&gt;
                                    {products.map(p =&gt; (
                                        &lt;div key={p.id} className="bg-tertiary p-4 rounded-lg flex justify-between items-center"&gt;
                                            &lt;div className="flex items-center space-x-4"&gt;
                                                &lt;img src={p.imageUrl} className="w-16 h-16 object-cover rounded-md" /&gt;
                                                &lt;p className="font-bold text-primary"&gt;{p.name} - {p.price}&lt;/p&gt;
                                            &lt;/div&gt;
                                            &lt;div className="flex space-x-2"&gt;
                                                &lt;button onClick={() =&gt; handleEdit(p)} className="bg-blue-500 hover:bg-blue-600 text-white py-1 px-3 rounded"&gt;{t.edit}&lt;/button&gt;
                                                &lt;button onClick={() =&gt; handleDeleteProduct(p.id)} className="bg-red-500 hover:bg-red-600 text-white py-1 px-3 rounded"&gt;{t.delete}&lt;/button&gt;
                                            &lt;/div&gt;
                                        &lt;/div&gt;
                                    ))}
                                &lt;/div&gt;
                            &lt;/div&gt;
                        &lt;/div&gt;
                    )}
                    {view === 'managePromo' &amp;&amp; (
                        &lt;div&gt;
                            &lt;button onClick={() =&gt; setView('dashboard')} className="mb-4 bg-tertiary p-2 rounded-lg"&gt; {t.backToPanel}&lt;/button&gt;
                            &lt;div className="bg-secondary p-8 rounded-2xl border-color"&gt;
                                &lt;h2 className="text-2xl font-bold mb-6 text-primary"&gt;{t.managePromoCodes}&lt;/h2&gt;
                                &lt;form onSubmit={handlePromoSubmit} className="space-y-4 mb-8 bg-tertiary p-6 rounded-lg"&gt;
                                    &lt;h3 className="text-xl font-bold"&gt;{t.addPromoCode}&lt;/h3&gt;
                                    &lt;input type="text" placeholder={t.promoCodeName} value={promoCodeName} onChange={e =&gt; setPromoCodeName(e.target.value.toUpperCase())} className="w-full p-3 bg-primary rounded-lg border-color text-primary" /&gt;
                                    &lt;div&gt;
                                        &lt;label htmlFor="discount" className="block text-secondary mb-2"&gt;{t.discountPercentage}: &lt;span className="font-bold accent-text"&gt;{promoDiscount}%&lt;/span&gt;&lt;/label&gt;
                                        &lt;input type="range" id="discount" min="1" max="100" value={promoDiscount} onChange={e =&gt; setPromoDiscount(e.target.value)} className="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-bg"/&gt;
                                    &lt;/div&gt;
                                    &lt;div&gt;
                                        &lt;label htmlFor="usageLimit" className="block text-secondary mb-2"&gt;{t.usageLimit}:&lt;/label&gt;
                                        &lt;input type="number" id="usageLimit" min="1" max="1000" value={promoUsageLimit} onChange={e =&gt; setPromoUsageLimit(e.target.value)} className="w-full p-3 bg-primary rounded-lg border-color text-primary" /&gt;
                                    &lt;/div&gt;
                                    &lt;button type="submit" className="accent-bg hover:accent-bg-secondary text-white font-bold py-2 px-4 rounded-lg"&gt;{t.addPromoCode}&lt;/button&gt;
                                &lt;/form&gt;
                                &lt;h3 className="text-xl font-bold mb-4"&gt;{t.existingPromoCodes}&lt;/h3&gt;
                                &lt;div className="space-y-4"&gt;
                                    {promoCodes.map(promo =&gt; (
                                        &lt;div key={promo.id} className="bg-tertiary p-4 rounded-lg flex justify-between items-center"&gt;
                                            &lt;div&gt;
                                                &lt;p className="font-bold text-primary"&gt;{promo.code}&lt;/p&gt;
                                                &lt;p className="text-secondary"&gt;{t.discount}: {promo.discount}%&lt;/p&gt;
                                                &lt;p className="text-secondary"&gt;{t.used}: {promo.timesUsed} / {promo.usageLimit}&lt;/p&gt;
                                            &lt;/div&gt;
                                            &lt;button onClick={() =&gt; handleDeletePromo(promo.id)} className="bg-red-500 hover:bg-red-600 text-white p-2 rounded-full"&gt;
                                                 &lt;svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"&gt;&lt;path fillRule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z" clipRule="evenodd" /&gt;&lt;/svg&gt;
                                            &lt;/button&gt;
                                        &lt;/div&gt;
                                    ))}
                                &lt;/div&gt;
                            &lt;/div&gt;
                        &lt;/div&gt;
                    )}
                    
                    {view === 'dashboard' &amp;&amp; (
                        &lt;div className="grid grid-cols-1 lg:grid-cols-2 gap-8 mt-8"&gt;
                            &lt;div className="bg-secondary p-8 rounded-2xl border-color"&gt;
                                &lt;h2 className="text-2xl font-bold mb-6"&gt;{t.purchaseOrders}&lt;/h2&gt;
                                &lt;div className="flex space-x-2 mb-4"&gt;
                                    &lt;button onClick={() =&gt; setOrderFilter('all')} className={`px-4 py-2 rounded-lg ${orderFilter === 'all' ? 'accent-bg text-white' : 'bg-tertiary text-primary'}`}&gt;{t.all}&lt;/button&gt;
                                    &lt;button onClick={() =&gt; setOrderFilter('today')} className={`px-4 py-2 rounded-lg ${orderFilter === 'today' ? 'accent-bg text-white' : 'bg-tertiary text-primary'}`}&gt;{t.today}&lt;/button&gt;
                                    &lt;button onClick={() =&gt; setOrderFilter('3days')} className={`px-4 py-2 rounded-lg ${orderFilter === '3days' ? 'accent-bg text-white' : 'bg-tertiary text-primary'}`}&gt;{t.last3days}&lt;/button&gt;
                                    &lt;button onClick={() =&gt; setOrderFilter('month')} className={`px-4 py-2 rounded-lg ${orderFilter === 'month' ? 'accent-bg text-white' : 'bg-tertiary text-primary'}`}&gt;{t.lastMonth}&lt;/button&gt;
                                &lt;/div&gt;
                                &lt;div className="space-y-4 max-h-96 overflow-y-auto"&gt;
                                    {filteredOrders.map(order =&gt; (
                                        &lt;div key={order.id} className="bg-tertiary p-4 rounded-lg flex justify-between items-center"&gt;
                                            &lt;div&gt;
                                                &lt;p&gt;&lt;b&gt;{t.product}:&lt;/b&gt; {order.productName}&lt;/p&gt;
                                                &lt;p&gt;&lt;b&gt;{t.user}:&lt;/b&gt; {order.userEmail}&lt;/p&gt;
                                                &lt;p&gt;&lt;b&gt;{t.date}:&lt;/b&gt; {new Date(order.timestamp?.toDate()).toLocaleString()}&lt;/p&gt;
                                                {order.promoCodeUsed &amp;&amp; &lt;p&gt;&lt;b&gt;{t.promoCode}:&lt;/b&gt; &lt;span className="accent-text"&gt;{order.promoCodeUsed}&lt;/span&gt;&lt;/p&gt;}
                                            &lt;/div&gt;
                                            &lt;button onClick={() =&gt; handleDeleteOrder(order.id)} className="bg-red-600 hover:bg-red-700 p-2 rounded-full text-white"&gt;
                                                &lt;svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"&gt;&lt;path fillRule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z" clipRule="evenodd" /&gt;&lt;/svg&gt;
                                            &lt;/button&gt;
                                        &lt;/div&gt;
                                    ))}
                                &lt;/div&gt;
                            &lt;/div&gt;
                            &lt;div className="bg-secondary p-8 rounded-2xl border-color"&gt;
                                &lt;h2 className="text-2xl font-bold mb-6"&gt;{t.supportTickets}&lt;/h2&gt;
                                &lt;div className="space-y-4 max-h-96 overflow-y-auto"&gt;
                                    {tickets.length &gt; 0 ? tickets.map(ticket =&gt; (
                                        &lt;div key={ticket.id} onClick={() =&gt; setActiveTicketId(ticket.id)} className="bg-tertiary p-4 rounded-lg flex justify-between items-center cursor-pointer hover:bg-gray-600"&gt;
                                            &lt;div&gt;
                                                &lt;p className="font-bold"&gt;{ticket.subject}&lt;/p&gt;
                                                &lt;p className="text-sm text-secondary"&gt;{t.user}: {ticket.userName} ({ticket.userEmail})&lt;/p&gt;
                                            &lt;/div&gt;
                                            &lt;span className="text-sm text-secondary"&gt;{new Date(ticket.lastUpdated?.toDate()).toLocaleString()}&lt;/span&gt;
                                        &lt;/div&gt;
                                    )) : &lt;p&gt;{t.noTickets}&lt;/p&gt;}
                                &lt;/div&gt;
                            &lt;/div&gt;
                        &lt;/div&gt;
                    )}
                    {view === 'manageFAQ' &amp;&amp; ( &lt;div&gt; {/* ... manage FAQ form ... */} &lt;/div&gt; )}
                &lt;/div&gt;
            );
        }

        function Footer({t}) {
            return (
                &lt;footer className="bg-secondary text-secondary p-6 mt-12 border-t border-color"&gt;
                    &lt;div className="container mx-auto text-center"&gt;
                        &lt;p&gt;&amp;copy; {new Date().getFullYear()} Asonik Store. {t.rightsReserved}&lt;/p&gt;
                        &lt;p className="text-sm mt-2"&gt;{t.developedWithLove}&lt;/p&gt;
                    &lt;/div&gt;
                &lt;/footer&gt;
            );
        }
        
        function App() {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);
            const [products, setProducts] = useState([]);
            const [faqs, setFaqs] = useState([]);
            const [page, setPage] = useState('home');
            const [alertInfo, setAlertInfo] = useState(null);
            const [language, setLanguage] = useState('ru');
            const [currency, setCurrency] = useState('UZS'); // Default currency is now UZS
            const [profileVisible, setProfileVisible] = useState(false);
            const [activeTicketId, setActiveTicketId] = useState(null);
            const [selectedProduct, setSelectedProduct] = useState(null);
            const [purchasingProduct, setPurchasingProduct] = useState(null);
            const [yooMoneyData, setYooMoneyData] = useState(null); // New state for YooMoney modal
            const [theme, setTheme] = useState('dark');

            useEffect(() =&gt; { document.body.className = theme; }, [theme]);

            useEffect(() =&gt; {
                 const params = new URLSearchParams(window.location.search);
                const productId = params.get('product');
                if (productId &amp;&amp; products.length &gt; 0) {
                    const productToShow = products.find(p =&gt; p.id === productId);
                    if (productToShow) {
                        setSelectedProduct(productToShow);
                        window.history.replaceState({}, document.title, window.location.pathname);
                    }
                }
            }, [products]);
            
            const isAdmin = user &amp;&amp; user.uid === ADMIN_UID;
            const t = translations[language];
            
            useEffect(() =&gt; {
                const unsubscribe = onAuthStateChanged(auth, (currentUser) =&gt; { setUser(currentUser); });
                return () =&gt; unsubscribe();
            }, []);

            useEffect(() =&gt; {
                setLoading(true);
                const q = query(collection(db, "products"), orderBy('createdAt', 'desc'));
                const unsubProducts = onSnapshot(q, (snapshot) =&gt; {
                    setProducts(snapshot.docs.map(doc =&gt; ({ id: doc.id, ...doc.data() })));
                    setLoading(false);
                }, (error) =&gt; { console.error("Error fetching products:", error); setLoading(false); });

                const unsubFaqs = onSnapshot(collection(db, "faq"), (snapshot) =&gt; {
                    setFaqs(snapshot.docs.map(doc =&gt; ({ id: doc.id, ...doc.data() })));
                });

                return () =&gt; { unsubProducts(); unsubFaqs(); };
            }, []);

            const handleLogin = async () =&gt; { try { await signInWithPopup(auth, provider); } catch (error) { console.error("Login Error:", error); setAlertInfo({ message: "Login failed: " + error.message }); } };
            const handleLogout = async () =&gt; { try { await signOut(auth); setPage('home'); } catch (error) { console.error("Logout Error:", error); } };
            
            const handleBuy = (product) =&gt; {
                if (user) {
                    setSelectedProduct(null);
                    setPurchasingProduct(product);
                } else {
                    setAlertInfo({ message: t.loginToBuy });
                }
            };

            const handleYooMoneyPayment = (product, purchaseDetails) =&gt; {
                setYooMoneyData({ product, purchaseDetails });
            };

            const handleConfirmPurchase = async (product, purchaseDetails) =&gt; {
                if (!user) return;
                try {
                    await addDoc(collection(db, 'orders'), {
                        userId: user.uid, userEmail: user.email, productId: product.id,
                        productName: product.name, timestamp: serverTimestamp(),
                        originalPrice: product.price,
                        finalPrice: purchaseDetails.finalPrice,
                        promoCodeUsed: purchaseDetails.promoCodeUsed,
                        paymentMethod: purchaseDetails.paymentMethod
                    });
                    
                    if (purchaseDetails.promoCodeUsed) {
                        const promoRef = doc(db, 'promoCodes', purchaseDetails.promoCodeUsed);
                        await updateDoc(promoRef, { timesUsed: increment(1) });
                    }

                    const productRef = doc(db, 'products', product.id);
                    await updateDoc(productRef, { popularity: increment(1) });
                } catch (error) { 
                    console.error("Order creation error: ", error);
                    setAlertInfo({ message: t.errorOccurred });
                }
            };

            const handleDeleteProduct = (productId) =&gt; {
                setAlertInfo({ message: t.confirmDelete, onConfirm: async () =&gt; {
                    try { await deleteDoc(doc(db, "products", productId)); setAlertInfo({ message: t.productDeleted }); } 
                    catch (error) { setAlertInfo({ message: t.errorOccurred }); }
                }});
            };

            const handleAlertConfirm = () =&gt; { if (alertInfo &amp;&amp; alertInfo.onConfirm) alertInfo.onConfirm(); setAlertInfo(null); };

            const renderPage = () =&gt; {
                switch (page) {
                    case 'admin': return isAdmin ? &lt;AdminPage {...{products, faqs, setAlertInfo, t, setActiveTicketId, handleDeleteProduct}} /&gt; : &lt;HomePage {...{products, onProductClick: setSelectedProduct, t, currency, convertPrice, loading}} /&gt;;
                    case 'support': return user ? &lt;SupportPage {...{user, t, setActiveTicketId}}/&gt; : &lt;div className="text-center text-primary p-10"&gt;{t.loginForSupport}&lt;/div&gt;;
                    case 'faq': return &lt;FAQPage faqs={faqs} t={t} /&gt;;
                    default: return &lt;HomePage {...{products, onProductClick: setSelectedProduct, t, currency, convertPrice, loading}} /&gt;;
                }
            };
            
            if (loading &amp;&amp; !products.length) return &lt;LoadingSpinner /&gt;;

            return (
                &lt;div className="bg-primary min-h-screen font-sans flex flex-col"&gt;
                    &lt;Header {...{user, onLogin: handleLogin, onLogout: handleLogout, setPage, isAdmin, t, currency, setCurrency, language, setLanguage, setProfileVisible, theme, setTheme}} /&gt;
                    &lt;div className="flex-grow"&gt;{renderPage()}&lt;/div&gt;
                    
                    {selectedProduct &amp;&amp; &lt;ProductModal product={selectedProduct} user={user} onClose={() =&gt; setSelectedProduct(null)} onBuy={handleBuy} setAlertInfo={setAlertInfo} t={t} currency={currency} convertPrice={convertPrice} /&gt;}
                    {purchasingProduct &amp;&amp; user &amp;&amp; &lt;PurchaseModal product={purchasingProduct} onClose={() =&gt; setPurchasingProduct(null)} onConfirm={handleConfirmPurchase} onYooMoney={handleYooMoneyPayment} t={t} currency={currency} convertPrice={convertPrice} setAlertInfo={setAlertInfo} /&gt;}
                    {yooMoneyData &amp;&amp; user &amp;&amp; &lt;YooMoneyModal data={yooMoneyData} onClose={() =&gt; setYooMoneyData(null)} onConfirm={handleConfirmPurchase} t={t} currency={currency} convertPrice={convertPrice} /&gt;}
                    
                    {activeTicketId &amp;&amp; user &amp;&amp; &lt;ChatModal ticketId={activeTicketId} user={user} isAdmin={isAdmin} onClose={() =&gt; setActiveTicketId(null)} t={t} /&gt;}
                    {alertInfo &amp;&amp; &lt;AlertModal message={alertInfo.message} onConfirm={alertInfo.onConfirm ? handleAlertConfirm : null} onCancel={() =&gt; setAlertInfo(null)} t={t} /&gt;}
                    {profileVisible &amp;&amp; user &amp;&amp; &lt;ProfileModal user={user} onClose={() =&gt; setProfileVisible(false)} t={t} setAlertInfo={setAlertInfo} /&gt;}
                    &lt;Footer t={t}/&gt;
                &lt;/div&gt;
            );
        }
        
        // --- Localization &amp; Currency ---
        const translations = {
            ru: {
                home: '', support: '', faq: 'FAQ', adminPanelTitle: '-', profile: '', logout: '', login: '',
                buy: '', confirmation: '', cancel: '', ok: 'OK', confirm: '',
                loginToView: ', ,    .',
                loginToBuy: ', ,   .',
                imageNotFound: '  ',
                catalogTitle: ' ', catalogSubtitle: '    ',
                addProduct: ' ', editProduct: ' ', edit: '.', delete: '.',
                productName: ' ', productNominal: ' (-: 100 )', description: '', priceInRub: ' ( RUB)', imageUrl: 'URL ',
                addProductBtn: ' ', updateProduct: ' ', fillAllFields: ',   .', productList: ' ',
                productAdded: '  !', productUpdated: '  !', errorOccurred: ' .',
                confirmDelete: ' ,     ?', productDeleted: ' .',
                supportTickets: ' ', user: '',
                noTickets: '    .',
                loginForSupport: ',   ,    .',
                avatarUpdated: '  !', uploadingAvatar: ' ', revertAvatar: '  ', avatarReverted: ' .',
                enterMessagePlaceholder: '  ...',
                checkout: ' ', youAreBuying: ' ', choosePayment: '  ',
                contactSeller: '   (Telegram)', unavailable: '', cardPayment: ' ', bankTransfer: ' ',
                rightsReserved: '  .', developedWithLove: '    ',
                russian: '', english: 'English', uzbek: 'O\'zbekcha',
                ruble: '', dollar: '', sum: "So'm",
                purchaseOrders: '  ', all: '', today: ' ', last3days: ' 3 ', lastMonth: ' ', product: '', date: '',
                searchPlaceholder: '  ...', category: '', games: '', apps: '', sortBy: '', newSort: '', popularSort: '', productsNotFound: '  ',
                pinProduct: ' ', pinned: '', loading: '...',
                uploadFile: '', noApiKey: ' API  ImgBB  !', imageUploaded: '  !',
                linkCopied: ' !', confirmDeleteOrder: ' ,     ?', orderDeleted: ' .',
                manageProducts: ' ', backToPanel: '  ', uploadAvatar: ' ',
                chatWithAdmin: '  ', chatWith: ' ', supportSubtitle: '    ,   ,   .',
                darkTheme: '', lightTheme: '', asonikTheme: '', setColorAvatar: ' ',
                manageFaq: ' FAQ', question: '', answer: '', addFaq: ' FAQ', updateFaq: ' FAQ', faqAdded: 'FAQ  ', faqUpdated: 'FAQ  ', confirmDeleteFaq: ' ,     FAQ?', faqDeleted: 'FAQ .', faqTitle: '  ',
                managePromoCodes: ' ', promoCode: '', discount: '', addPromoCode: ' ',
                promoCodeName: ' ', discountPercentage: ' ', existingPromoCodes: ' ',
                promoAdded: ' !', promoDeleted: ' !', confirmDeletePromo: ' ,     ?',
                payWithPromo: ' ', apply: '', promoNotFound: '    .', promoApplied: ' ',
                usageLimit: ' ', used: '', promoLimitReached: '    .',
                verifiedByStore: ' ',
                yooMoneyPayment: '  YooMoney', yooMoneyInstruction: ' QR-       .',
                amountToPay: '  :', orPayWithLink: '   :',
                afterPaymentInstruction: '        Telegram @asonikofficial  .',
                iPaidSendScreenshot: '    '
            },
            en: {
                // ... English translations ...
                loginToBuy: 'Please log in to make a purchase.',
                managePromoCodes: 'Manage Promo Codes', promoCode: 'Promo Code', discount: 'Discount', addPromoCode: 'Add Promo Code',
                promoCodeName: 'Promo Code Name', discountPercentage: 'Discount Percentage', existingPromoCodes: 'Existing Promo Codes',
                promoAdded: 'Promo code added!', promoDeleted: 'Promo code deleted!', confirmDeletePromo: 'Are you sure you want to delete this promo code?',
                payWithPromo: 'Apply a promo code', apply: 'Apply', promoNotFound: 'Promo code not found or invalid.', promoApplied: 'Promo code applied',
                usageLimit: 'Usage Limit', used: 'Used', promoLimitReached: 'The usage limit for this promo code has been reached.',
                verifiedByStore: 'Verified by Store',
                yooMoneyPayment: 'YooMoney Payment', yooMoneyInstruction: 'Scan the QR code or use the link below to pay.',
                amountToPay: 'Amount to pay:', orPayWithLink: 'Or pay via link:',
                afterPaymentInstruction: 'After payment, take a screenshot and send it to @asonikofficial on Telegram for confirmation.',
                iPaidSendScreenshot: 'I have paid &amp; will send the screenshot'
            },
            uz: {
                // ... Uzbek translations ...
                loginToBuy: 'Xarid qilish uchun tizimga kiring.',
                managePromoCodes: 'Promo-kodlarni boshqarish', promoCode: 'Promo-kod', discount: 'Chegirma', addPromoCode: 'Promo-kod qo\'shish',
                promoCodeName: 'Promo-kod nomi', discountPercentage: 'Chegirma foizi', existingPromoCodes: 'Mavjud promo-kodlar',
                promoAdded: 'Promo-kod qo\'shildi!', promoDeleted: 'Promo-kod o\'chirildi!', confirmDeletePromo: 'Haqiqatan ham ushbu promo-kodni o\'chirmoqchimisiz?',
                payWithPromo: 'Promo-kodni qo\'llash', apply: 'Qo\'llash', promoNotFound: 'Promo-kod topilmadi yoki yaroqsiz.', promoApplied: 'Promo-kod qo\'llanildi',
                usageLimit: 'Foydalanish chegarasi', used: 'Foydalanilgan', promoLimitReached: 'Ushbu promo-koddan foydalanish chegarasi tugadi.',
                verifiedByStore: 'Do\'kon tomonidan tasdiqlangan',
                yooMoneyPayment: 'YooMoney orqali to\'lov', yooMoneyInstruction: 'To\'lov uchun QR-kodni skanerlang yoki quyidagi havoladan foydalaning.',
                amountToPay: 'To\'lanadigan summa:', orPayWithLink: 'Yoki havola orqali to\'lang:',
                afterPaymentInstruction: 'To\'lovdan so\'ng, skrinshot oling va tasdiqlash uchun @asonikofficial manziliga Telegram orqali yuboring.',
                iPaidSendScreenshot: 'Men to\'ladim va skrinshotni yuboraman'
            }
        };

        const currencyRates = { RUB: 1, USD: 0.011, UZS: 140 };
        const currencySymbols = { RUB: '', USD: '$', UZS: "so'm" };

        const convertPrice = (priceInRub, targetCurrency) =&gt; {
            const rate = currencyRates[targetCurrency];
            const symbol = currencySymbols[targetCurrency];
            if (!rate || !priceInRub) return `0 ${symbol}`;
            const convertedPrice = priceInRub * rate;
            return `${convertedPrice.toLocaleString('ru-RU', { maximumFractionDigits: 2 })} ${symbol}`;
        };

        ReactDOM.render(&lt;App /&gt;, document.getElementById('root'));
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
